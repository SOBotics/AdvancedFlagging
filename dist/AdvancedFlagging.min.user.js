// ==UserScript==
// @name         Advanced Flagging
// @namespace    https://github.com/SOBotics
// @version      1.3.7
// @author       Robert Rudman
// @contributor  double-beep
// @match        *://*.stackexchange.com/*
// @match        *://*.stackoverflow.com/*
// @match        *://*.superuser.com/*
// @match        *://*.serverfault.com/*
// @match        *://*.askubuntu.com/*
// @match        *://*.stackapps.com/*
// @match        *://*.mathoverflow.net/*
// @exclude      *://chat.stackexchange.com/*
// @exclude      *://chat.meta.stackexchange.com/*
// @exclude      *://chat.stackoverflow.com/*
// @exclude      *://*.area51.stackexchange.com/*
// @exclude      *://data.stackexchange.com/*
// @exclude      *://stackoverflow.com/c/*
// @exclude      *://winterbash*.stackexchange.com/*
// @exclude      *://api.stackexchange.com/*
// @grant        GM_xmlhttpRequest
// @grant        GM_listValues
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_deleteValue
// @grant        GM_addStyle
// ==/UserScript==

(()=>{var e={422:(e,t,a)=>{var o,n;o=[a,t,a(205),a(436),a(26),a(779),a(451),a(232),a(417),a(769),a(216)],void 0===(n=function(e,t,a,o,n,s,r,i,l,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.displayToaster=void 0;const p=StackExchange.options.user.fkey;async function u(e,t,a,o,n,s,r){if(r)try{const t=await fetch(`/posts/${e}/comments`,{method:"POST",body:c.getFormDataFromObject({fkey:p,comment:r})});!function(e,t){const a=StackExchange.comments.uiForPost($(`#comments-${e}`));a.addShow(!0,!1),a.showComments(t,null,!1,!0),$(document).trigger("comment",e)}(e,await t.text())}catch(e){c.displayError("Failed to comment on post"),console.error(e)}if(a&&"NoFlag"!==t.ReportType){const a=o.getCopyPastorId(),r=o.getTargetUrl(),i=t.GetCustomFlagText&&a&&r?t.GetCustomFlagText(r,a):null;b=!0;const l="PostLowQuality"===t.ReportType?s?"PostLowQuality":"AnswerNotAnAnswer":t.ReportType;try{const a=await fetch(`//${window.location.hostname}/flags/posts/${e}/add/${l}`,{method:"POST",body:c.getFormDataFromObject({fkey:p,otherText:"PostOther"===t.ReportType?i:""})}),o=await a.json();if(o.Success)g(n,t.ReportType);else{const e=`Failed to flag the post with outcome ${o.Outcome}: ${o.Message}.`;h(function(e){let t="Failed to flag: ";return/already flagged/.exec(e.Message)?t+="post already flagged":/limit reached/.exec(e.Message)?t+="post flag limit reached":/You may only flag a post every \d+ seconds?/.exec(JSON.stringify(e))?t+="rate-limited":t+=e.Message,t}(o),e)}}catch(e){h("Failed to flag post",e)}}}const m=c.popupWrapper;function g(e,t){if(!t)return;const a=`Flagged ${w(t)}`;c.attachPopover(e[0],a,"bottom-start"),c.showInlineElement(e),c.displaySuccess(a)}function h(e,t){c.displayError(e),console.error(t)}function f(e){return e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,"$1").replace(/\[([^\]]+)\][^(]*?/g,"$1").replace(/_([^_]+)_/g,"$1").replace(/\*\*([^*]+)\*\*/g,"$1").replace(/\*([^*]+)\*/g,"$1").replace(" - From Review","")}function y(e,t,a,o){const s=new n.NattyAPI(e,t||new Date,a||new Date),r=s.WasReported();return o&&r&&(c.showInlineElement(o),o.attr("href",`//sentinel.erwaysoftware.com/posts/aid/${e}`).attr("target","_blank")),s}function w(e){switch(e){case"AnswerNotAnAnswer":return"as NAA";case"PostOffensive":return"as R/A";case"PostSpam":return"as spam";case"NoFlag":return"";case"PostOther":return"for moderator attention";case"PostLowQuality":return"as VLQ";default:return""}}function v(e){const t=e.parent().attr("aria-describedby")||"";$(`#${t}`).addClass("sm:wmn-initial md:wmn-initial wmn4")}async function k(e,t){for(const a of t)try{const t=e.SendFeedback(a),o=await t;if(!o)continue;c.displaySuccess(o)}catch(e){return c.displayError(e.message),!1}return!0}t.displayToaster=function(e,t){m.hasClass("hide")&&m.empty();const a=c.getMessageDiv(e,t);m.append(a),m.removeClass("hide").addClass("show"),window.setTimeout((()=>m.removeClass("show").addClass("hide")),c.popupDelay)};let b=!1;function C(){Promise.all([r.MetaSmokeAPI.Setup(c.metaSmokeKey),r.MetaSmokeAPI.QueryMetaSmokeInternal(),i.CopyPastorAPI.getAllCopyPastorIds(),n.NattyAPI.getAllNattyIds()]).then((()=>{d.GreaseMonkeyCache.GetFromCache(c.ConfigurationLinkDisabled)||o.parseQuestionsAndAnswers((e=>{if(!e.element.length)return;const t="Answer"===e.type?e.questionTime:e.creationDate,o="Answer"===e.type?e.creationDate:null,n="Question"===e.page?e.element.find(".js-post-menu").children().first():e.element.find(`a.${"Question"===e.type?"question":"answer"}-hyperlink`),l=c.advancedFlaggingLink.clone();"Question"===e.page&&n.append(c.gridCellDiv.clone().append(l));const p=c.nattyIcon.clone(),m=c.guttenbergIcon.clone(),h=c.smokeyIcon.clone();c.attachPopover(p.find("a")[0],"Reported by Natty","bottom-start"),c.attachPopover(m.find("a")[0],"Reported by Guttenberg","bottom-start"),c.attachPopover(h.find("a")[0],"Reported by Smokey","bottom-start");const C=new i.CopyPastorAPI(e.postId),F=[];var T;"Answer"===e.type&&c.isStackOverflow&&(F.push(y(e.postId,t,o,p)),F.push((T=e.postId,new s.GenericBotAPI(T))),F.push(function(e,t){const a=e.getCopyPastorId();return a&&(c.showInlineElement(t),t.attr("href",`https://copypastor.sobotics.org/posts/${a}`).attr("target","_blank")),e}(C,m))),F.push(function(e,t,a){const o=r.MetaSmokeAPI.getSmokeyId(e);return o&&(a.attr("href",`https://metasmoke.erwaysoftware.com/post/${o}`).attr("target","_blank"),c.showInlineElement(a)),new r.MetaSmokeAPI(e,t)}(e.postId,e.type,h));const I=c.performedActionIcon(),R=c.failedActionIcon(),S=c.reportedIcon();if("Question"===e.page){const t=e.element.hasClass("deleted-answer"),s=d.GreaseMonkeyCache.GetFromCache(c.ConfigurationWatchFlags);c.addXHRListener((t=>{if(!s||b||200!==t.status||!c.flagsUrlRegex.exec(t.responseURL))return;const o=c.getFlagsUrlRegex(e.postId).exec(t.responseURL);if(!o)return;const n=a.flagCategories.flatMap((e=>e.FlagTypes)).find((e=>e.ReportType===o[1]));n&&(g(S,n.ReportType),k(n,F))})),n.append(I,S,R,p,m,h);const r=c.qualifiesForVlq(e.score,o||new Date),i=function(e,t,o,n,s,r,i,l){const p=d.GreaseMonkeyCache.GetFromCache(c.ConfigurationEnabledFlags),m=d.GreaseMonkeyCache.GetFromCache(c.ConfigurationDefaultNoComment),g=d.GreaseMonkeyCache.GetFromCache(c.ConfigurationDefaultNoFlag),h=e.element.find(".comment-body"),y=c.dropDown.clone(),b=`comment_checkbox_${e.postId}`,C=`flag_checkbox_${e.postId}`,F=c.getOptionBox(b),T=c.getOptionBox(C);T.prop("checked",!g),F.prop("checked",!m&&!h.length&&c.isStackOverflow);const I=a.flagCategories.filter((t=>t.AppliesTo.includes(e.type)&&t.FlagTypes.some((e=>p&&p.includes(e.Id)))));for(const a of I){const d=c.getCategoryDiv(a.IsDangerous);for(const m of a.FlagTypes.filter((e=>p&&p.includes(e.Id)))){const a=c.reportLink.clone(),p=c.dropdownItem.clone(),g=r.getIsRepost(),h=r.getCopyPastorId();if(!m.Enabled(g,h))continue;c.showElement(a),a.text(m.DisplayName),p.append(a),d.append(p),y.append(d);let b=m.GetComment?.({Reputation:e.authorReputation,AuthorName:e.authorName})||null;const C=w(m.ReportType),I=`This option will${C?" ":" not"} flag the post <b>${C}</b></br>`+(b?`and add the following comment: ${b}`:"");c.attachHtmlPopover(a.parent()[0],I,"right-start").then((()=>v(a))),a.on("click",(async()=>{if(!t){if(!F.is(":checked")&&b){const t=f(b);a=e.element,d=t,a.find(".comment-body .comment-copy").each(((e,t)=>{const a=$(t);a.text()===d&&a.closest("li").find("a.comment-up.comment-up-off").trigger("click")})),b=null}await u(e.postId,m,T.is(":checked"),r,o,i,b)}var a,d;c.hideElement(y);const p=await k(m,s);"NoFlag"===m.ReportType&&(p?(c.attachPopover(n[0],`Performed action: ${m.DisplayName}`,"bottom-start"),c.showElement(n)):(c.attachPopover(l[0],`Failed to perform action: ${m.DisplayName}`,"bottom-start"),c.showElement(l)))}))}d.html()&&y.append(c.divider.clone())}if(c.isStackOverflow){const e=c.getOptionLabel("Leave comment",b),t=c.plainDiv.clone();t.append(F,e),y.append(t)}const R=c.getOptionLabel("Flag",C),S=c.plainDiv.clone();return S.append(T,R),y.append(S,c.popoverArrow.clone()),y}(e,t,S,I,F,C,r,R);l.append(i),d.GreaseMonkeyCache.GetFromCache(c.ConfigurationOpenOnHover)?l.on("mouseover",(e=>{e.stopPropagation(),e.target===l.get(0)&&c.showElement(i)})).on("mouseleave",(e=>{e.stopPropagation(),setTimeout((()=>c.hideElement(i)),200)})):(l.on("click",(e=>{e.stopPropagation(),e.target===l.get(0)&&c.showElement(i)})),$(window).on("click",(()=>c.hideElement(i))))}else n.after(h,m,p)}))})),GM_addStyle("\n#snackbar {\n    margin-left: -125px;\n}\n\n#snackbar.show {\n    opacity: 1;\n    transition: opacity 1s ease-out;\n    -ms-transition: opacity 1s ease-out;\n    -moz-transition: opacity 1s ease-out;\n    -webkit-transition: opacity 1s ease-out;\n}\n\n#snackbar.hide {\n    opacity: 0;\n    transition: opacity 1s ease-in;\n    -ms-transition: opacity 1s ease-in;\n    -moz-transition: opacity 1s ease-in;\n    -webkit-transition: opacity 1s ease-in;\n}\n\n.advanced-flagging-dialog {\n    min-width: 10rem !important;\n}\n\n#af-comments textarea {\n    resize: vertical;\n}"),c.waitForSvg().then((()=>l.SetupConfiguration())),$("body").append(m);const e=d.GreaseMonkeyCache.GetFromCache(c.ConfigurationWatchQueues),t=[];e&&c.addXHRListener((e=>{if(200!==e.status)return;if(c.isReviewItemRegex.exec(e.responseURL))return void(e=>{const a=JSON.parse(e),o=a.postId,n=$(a.content),s=c.parseDate($(".post-signature.owner .user-action-time span",n).attr("title")),r=c.parseDate($(".user-info .user-action-time span",n).attr("title"));s&&r&&(t[o]={questionTime:s,answerTime:r})})(e.responseText);const o=c.isDeleteVoteRegex.exec(e.responseURL);if(!o)return;const n=o[1]||o[2],s=Number(n);t[s]&&$(".answers-subheader").length&&k(a.flagCategories[2].FlagTypes[1],[y(s)])}))}$((()=>{let e=!1;function t(){e||(e=!0,C()),$(window).off("focus",t),$(window).off("mousemove",t)}$(window).on("focus",t),$(window).on("mousemove",t),document.hasFocus?.()&&t()}))}.apply(t,o))||(e.exports=n)},417:(e,t,a)=>{var o,n;o=[a,t,a(451),a(205),a(769),a(216)],void 0===(n=function(e,t,a,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetupConfiguration=void 0;const r=n.GreaseMonkeyCache.GetFromCache(s.ConfigurationEnabledFlags),i=o.flagCategories.flatMap((e=>e.FlagTypes)),l=[...new Set(i.map((e=>e.DefaultReportType)))].filter((e=>!/Post(?:Other|Offensive|Spam)/.exec(e)));function d(){const e=[];return r?(i.forEach((t=>{const a=r.indexOf(t.Id)>-1,o=c(t.DisplayName,a,`flag-type-${t.Id}`).children().eq(0);e.push(o.addClass("w25 lg:w25 md:w100 sm:w100"))})),e):e}function c(e,t,a=e.toLowerCase().replace(/\s/g,"_")){const o=s.getConfigHtml(a,e),n=o.find("input");return t&&n.prop("checked",!0),o}function p(e,t,a,o){const n=o?"d-block":"d-none",s=`${e}-${t}`.toLowerCase().replace(/\s/g,"");return $(`\n<div class="s-sidebarwidget" data-flag-id=${a}>\n  <button class="s-sidebarwidget--action s-btn t4 r4 af-expandable-trigger"\n          data-controller="s-expandable-control" aria-controls="${s}">Edit</button>\n  <button class="s-sidebarwidget--action s-btn s-btn__primary t4 r6 af-submit-content d-none">Save</button>\n  <div class="s-sidebarwidget--content d-block p12 fs-body3">${t}</div>\n  <div class="s-expandable" id="${s}">\n    <div class="s-expandable--content px8">\n      <div class="advanced-flagging-flag-option py8 mln6 ${n}">\n        <label class="fw-bold ps-relative d-inline-block z-selected l16">Flag as:</label>'\n        <div class="s-select d-inline-block r48"><select class="pl64">${r=o||"",l.map((e=>((e,t)=>`<option${e===t?" selected":""}>${e}</option>`)(e,r))).join("")}</select></div>\n      </div>\n    </div>\n  </div>\n</div>`);var r}t.SetupConfiguration=function(){!function(){if(!r){const e=i.map((e=>e.Id));n.GreaseMonkeyCache.StoreInCache(s.ConfigurationEnabledFlags,e)}n.GreaseMonkeyCache.GetFromCache(s.FlagTypesKey)?.length!==i.length&&n.GreaseMonkeyCache.StoreInCache(s.FlagTypesKey,i.map((e=>({Id:e.Id,FlagText:e.DefaultFlagText||"",Comments:{Low:e.DefaultComment||"",High:e.DefaultCommentHigh||""},ReportType:e.DefaultReportType}))))}(),function(){const e=s.overlayModal.clone();e.find(".s-modal--close").append(Svg.ClearSm());const t=[{SectionName:"General",Items:[{text:"Open dropdown on hover",configValue:s.ConfigurationOpenOnHover},{text:"Watch for manual flags",configValue:s.ConfigurationWatchFlags},{text:"Watch for queue responses",configValue:s.ConfigurationWatchQueues},{text:"Disable AdvancedFlagging link",configValue:s.ConfigurationLinkDisabled},{text:"Uncheck 'Leave comment' by default",configValue:s.ConfigurationDefaultNoComment},{text:"Uncheck 'Flag' by default",configValue:s.ConfigurationDefaultNoFlag},{text:"Add author's name before comments",configValue:s.ConfigurationAddAuthorName}].map((e=>{const t=n.GreaseMonkeyCache.GetFromCache(e.configValue);return c(e.text,t).attr("data-option-id",e.configValue)})),onSave:()=>{$(".af-section-general").find("input").each(((e,t)=>{n.GreaseMonkeyCache.StoreInCache($(t).parents().eq(2).data("option-id"),$(t).prop("checked"))}))}},{SectionName:"Flags",Items:d(),onSave:()=>{const e=$(".af-section-flags").find("input").get().filter((e=>$(e).prop("checked"))).map((e=>{const t=$(e).attr("id");return t?Number(/\d+/.exec(t)):0})).sort(((e,t)=>e-t));n.GreaseMonkeyCache.StoreInCache(s.ConfigurationEnabledFlags,e)}},{SectionName:"Admin",Items:[$("<a>").text("Clear Metasmoke Configuration").on("click",(()=>{a.MetaSmokeAPI.Reset(),s.displayStacksToast("Successfully cleared MS configuration.","success")})),$("<a>").text("Clear chat fkey").on("click",(()=>{n.GreaseMonkeyCache.Unset(s.CacheChatApiFkey),s.displayStacksToast("Successfully cleared chat fkey.","success")}))].map((e=>e.wrap(s.gridCellDiv.clone()).parent()))}];let o=!0;t.forEach((t=>{o||e.find("#af-modal-description").append("<hr>"),o=!1;const a=s.getSectionWrapper(t.SectionName);e.find("#af-modal-description").append(a),t.Items.forEach((e=>a.append(e)))})),e.find(".s-btn__primary").on("click",(e=>{e.preventDefault(),t.forEach((e=>e.onSave?.())),s.displayStacksToast("Configuration saved","success"),setTimeout((()=>window.location.reload()),500)})),$("body").append(e);const r=$(".af-section-flags").children("div");for(let e=0;e<r.length;e+=5)r.slice(e,e+5).wrapAll(s.inlineCheckboxesWrapper.clone());$('label[for="flag-type-16"]').parent().css("width",$('label[for="flag-type-11"]').parent().css("width")).removeClass("w25 lg:w25")}(),function(){const e=s.editCommentsPopup.clone();e.find(".s-modal--close").append(Svg.ClearSm());const t=s.commentsWrapper.clone(),a=s.flagsWrapper.clone();e.find(".s-modal--body").append(s.editContentWrapper.clone().append(t,a)),i.filter((e=>e.DefaultComment||e.DefaultFlagText)).forEach((e=>{const o=e.Comments,n=e.FlagText;if(n){const t=p("flag",e.DisplayName,e.Id);t.find(".s-expandable--content").prepend(s.getTextarea(n,"af-flag-content")),a.append(t)}if(!o?.Low)return;const r=p("comment",e.DisplayName,e.Id,e.ReportType),i=r.find(".s-expandable--content"),l=o.High?"d-block":"d-none",d=e=>$("<label>").addClass(`grid--cell s-label ${l}`).html(`${e} comment`);o.High&&i.prepend(d("HighRep").addClass("pt4"),s.getTextarea(o.High,"af-highrep")),i.prepend(d("LowRep"),s.getTextarea(o.Low,"af-lowrep")),t.append(r)})),$(document).on("click",".af-expandable-trigger",(e=>{const t=$(e.target),a=t.next();t.text("Edit"===t.text()?"Hide":"Edit"),a.hasClass("d-none")?s.showElement(a):s.hideElement(a)})).on("change",".advanced-flagging-flag-option select",(e=>{const t=$(e.target),a=t.val(),o=Number(t.parents(".s-sidebarwidget").attr("data-flag-id"));s.savePropertyToCache(o,"ReportType",a),s.displayStacksToast("Successfully changed the report flag type.","success")})).on("click",".af-submit-content",(e=>{const t=$(e.target),a=t.next().next(),o=Number(t.parents(".s-sidebarwidget").attr("data-flag-id"));if(!o)return void s.displayStacksToast("Failed to save options","danger");const n=a.find(".af-flag-content").val()||"",r=a.find(".af-lowrep").val()||"",i=a.find(".af-highrep").val()||"";n?s.savePropertyToCache(o,"FlagText",n):s.saveCommentsToCache(o,{Low:r,High:i}),s.displayStacksToast("Content saved successfully","success"),t.prev().trigger("click")})),$("body").append(e)}();const e=$(".site-footer--copyright").children(".-list"),t=s.configurationDiv.clone(),o=s.commentsDiv.clone(),l=s.configurationLink.clone(),u=s.commentsLink.clone();$(document).on("click","#af-modal-button",(()=>StackExchange.helpers.showModal(document.querySelector("#af-config")))),$(document).on("click","#af-comments-button",(()=>StackExchange.helpers.showModal(document.querySelector("#af-comments")))),o.append(u).insertAfter(e),t.append(l).insertAfter(e)}}.apply(t,o))||(e.exports=n)},205:(e,t,a)=>{var o,n;o=[a,t,a(216)],void 0===(n=function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flagCategories=void 0;const o=(e,t=50)=>e>t?"High":"Low";t.flagCategories=[{IsDangerous:!0,AppliesTo:["Answer","Question"],FlagTypes:[{Id:1,DisplayName:"Spam",DefaultReportType:"PostSpam",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>!0,SendFeedback:e=>e.ReportRedFlag()},{Id:2,DisplayName:"Rude or Abusive",DefaultReportType:"PostOffensive",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>!0,SendFeedback:e=>e.ReportRedFlag()}]},{IsDangerous:!0,AppliesTo:["Answer"],FlagTypes:[{Id:3,DisplayName:"Plagiarism",DefaultReportType:"PostOther",get ReportType(){return a.getReportType(this.Id)},Enabled:(e,t)=>!e&&Boolean(t),GetCustomFlagText:(e,t)=>a.getFullFlag(3,e,t),DefaultFlagText:"Possible plagiarism of another answer $TARGET$, as can be seen here $COPYPASTOR$",get FlagText(){return a.getFlagText(this.Id)},SendFeedback:e=>e.ReportPlagiarism()},{Id:4,DisplayName:"Duplicate answer",DefaultReportType:"PostOther",get ReportType(){return a.getReportType(this.Id)},Enabled:(e,t)=>e&&Boolean(t),GetCustomFlagText:(e,t)=>a.getFullFlag(4,e,t),GetComment:e=>a.getFullComment(4,e),DefaultFlagText:"The answer is a repost of their other answer $TARGET$, but as there are slight differences (see $COPYPASTOR$), an auto flag would not be raised.",get FlagText(){return a.getFlagText(this.Id)},DefaultComment:"Please don't add the [same answer to multiple questions](//meta.stackexchange.com/q/104227). Answer the best one and flag the rest as duplicates, once you earn enough reputation. If it is not a duplicate, [edit] the answer and tailor the post to the question.",get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportDuplicateAnswer()},{Id:5,DisplayName:"Bad attribution",DefaultReportType:"PostOther",get ReportType(){return a.getReportType(this.Id)},Enabled:(e,t)=>!e&&Boolean(t),GetCustomFlagText:(e,t)=>a.getFullFlag(5,e,t),DefaultFlagText:"This post is copied from [another answer]($TARGET$), as can be seen here $COPYPASTOR$. The author only added a link to the other answer, which is [not the proper way of attribution](//stackoverflow.blog/2009/06/25/attribution-required).",get FlagText(){return a.getFlagText(this.Id)},SendFeedback:e=>e.ReportPlagiarism()}]},{IsDangerous:!1,AppliesTo:["Answer"],FlagTypes:[{Id:6,DisplayName:"Link Only",DefaultReportType:"PostLowQuality",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(6,e),DefaultComment:`A link to a solution is welcome, but please ensure your answer is useful without it: [add context around the link](//meta.stackexchange.com/a/8259) so your fellow users will have some idea what it is and why it is there, then quote the most relevant part of the page you are linking to in case the target page is unavailable. [Answers that are little more than a link may be deleted.](${a.deletedAnswers})`,get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportNaa()},{Id:7,DisplayName:"Not an answer",DefaultReportType:"AnswerNotAnAnswer",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(7,e,o(e.Reputation)),DefaultComment:"This does not provide an answer to the question. You can [search for similar questions](/search), or refer to the related and linked questions on the right-hand side of the page to find an answer. If you have a related but different question, [ask a new question](/questions/ask), and include a link to this one to help provide context. See: [Ask questions, get answers, no distractions](/tour)",DefaultCommentHigh:`This post doesn't look like an attempt to answer this question. Every post here is expected to be an explicit attempt to *answer* this question; if you have a critique or need a clarification of the question or another answer, you can [post a comment](${a.commentHelp}) (like this one) directly below it. Please remove this answer and create either a comment or a new question. See: [Ask questions, get answers, no distractions](/tour).`,get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportNaa()},{Id:8,DisplayName:"Thanks",DefaultReportType:"AnswerNotAnAnswer",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(8,e,o(e.Reputation)),DefaultComment:`Please don't add _thanks_ as answers. They don't actually provide an answer to the question, and can be perceived as noise by its future visitors. Once you [earn](//meta.stackoverflow.com/q/146472) enough [reputation](${a.reputationHelp}), you will gain privileges to [upvote answers](${a.voteUpHelp}) you like. This way future visitors of the question will see a higher vote count on that answer, and the answerer will also be rewarded with reputation points. See [Why is voting important](${a.whyVote}).`,DefaultCommentHigh:`Please don't add _thanks_ as answers. They don't actually provide an answer to the question, and can be perceived as noise by its future visitors. Instead, [upvote answers](${a.voteUpHelp}) you like. This way future visitors of the question will see a higher vote count on that answer, and the answerer will also be rewarded with reputation points. See [Why is voting important](${a.whyVote}).`,get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportNaa()},{Id:9,DisplayName:"Me too",DefaultReportType:"AnswerNotAnAnswer",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(9,e),DefaultComment:`Please don't add *Me too* as answers. It doesn't actually provide an answer to the question. If you have a different but related question, then [ask](/questions/ask) it (reference this one if it will help provide context). If you are interested in this specific question, you can [upvote](${a.voteUpHelp}) it, leave a [comment](${a.commentHelp}), or start a [bounty](${a.setBounties}) once you have enough [reputation](${a.reputationHelp}).`,get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportNaa()},{Id:10,DisplayName:"Library",DefaultReportType:"PostLowQuality",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(10,e),DefaultComment:"Please don't just post some tool or library as an answer. At least demonstrate [how it solves the problem](//meta.stackoverflow.com/a/251605) in the answer itself.",get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportNaa()},{Id:11,DisplayName:"Comment",DefaultReportType:"AnswerNotAnAnswer",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(11,e,o(e.Reputation)),DefaultComment:`This does not provide an answer to the question. Once you have sufficient [reputation](${a.reputationHelp}) you will be able to [comment on any post](${a.commentHelp}); instead, [provide answers that don't require clarification from the asker](//meta.stackexchange.com/q/214173).`,DefaultCommentHigh:"This does not provide an answer to the question. Please write a comment instead.",get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportNaa()},{Id:12,DisplayName:"Duplicate",DefaultReportType:"AnswerNotAnAnswer",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(12,e),DefaultComment:`Instead of posting an answer which merely links to another answer, please instead [flag the question](${a.flagPosts}) as a duplicate.`,get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportNaa()},{Id:13,DisplayName:"Non English",DefaultReportType:"PostLowQuality",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(13,e),DefaultComment:"Please write your answer in English, as Stack Overflow is an [English-only site](//meta.stackoverflow.com/a/297680).",get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportNaa()},{Id:14,DisplayName:"Should be an edit",DefaultReportType:"AnswerNotAnAnswer",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(14,e),DefaultComment:'Please use the edit link on your question to add additional information. The "Post Answer" button should be used only for complete answers to the question.',get Comments(){return a.getComments(this.Id)},SendFeedback:e=>e.ReportNaa()}]},{IsDangerous:!1,AppliesTo:["Answer","Question"],FlagTypes:[{Id:15,DisplayName:"Looks Fine",DefaultReportType:"NoFlag",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>!0,SendFeedback:e=>e.ReportLooksFine()},{Id:16,DisplayName:"Needs Editing",DefaultReportType:"NoFlag",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>!0,SendFeedback:e=>e.ReportNeedsEditing()},{Id:17,DisplayName:"Vandalism",DefaultReportType:"NoFlag",get ReportType(){return a.getReportType(this.Id)},Enabled:()=>!0,SendFeedback:e=>e.ReportVandalism()}]}]}.apply(t,o))||(e.exports=n)},216:(e,t,a)=>{var o,n;o=[a,t,a(769),a(422)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waitForSvg=t.savePropertyToCache=t.saveCommentsToCache=t.getComments=t.getFlagText=t.getReportType=t.getFlagTypeFromCache=t.getSentMessage=t.parseDate=t.qualifiesForVlq=t.getFullFlag=t.getFullComment=t.getAllPostIds=t.addXHRListener=t.showConfirmModal=t.Delay=t.showMSTokenPopupAndGet=t.editCommentsPopup=t.inlineCheckboxesWrapper=t.overlayModal=t.flagsWrapper=t.commentsWrapper=t.editContentWrapper=t.commentsLink=t.commentsDiv=t.configurationLink=t.configurationDiv=t.advancedFlaggingLink=t.dropdownItem=t.reportLink=t.popoverArrow=t.dropDown=t.popupWrapper=t.divider=t.reportedIcon=t.failedActionIcon=t.performedActionIcon=t.getTextarea=t.getConfigHtml=t.getOptionLabel=t.getCategoryDiv=t.getOptionBox=t.getSectionWrapper=t.getMessageDiv=t.smokeyIcon=t.guttenbergIcon=t.nattyIcon=t.getFormDataFromObject=t.getParamsFromObject=t.displayError=t.displaySuccess=t.showInlineElement=t.hideElement=t.showElement=t.getFlagsUrlRegex=t.flagsUrlRegex=t.isDeleteVoteRegex=t.isReviewItemRegex=t.attachHtmlPopover=t.attachPopover=t.displayStacksToast=t.FlagTypesKey=t.MetaSmokeDisabledConfig=t.MetaSmokeUserKeyConfig=t.CacheChatApiFkey=t.ConfigurationAddAuthorName=t.ConfigurationLinkDisabled=t.ConfigurationEnabledFlags=t.ConfigurationWatchQueues=t.ConfigurationWatchFlags=t.ConfigurationDefaultNoComment=t.ConfigurationDefaultNoFlag=t.ConfigurationOpenOnHover=t.flagPosts=t.setBounties=t.whyVote=t.voteUpHelp=t.reputationHelp=t.commentHelp=t.deletedAnswers=t.gridCellDiv=t.plainDiv=t.isFlagsPage=t.isQuestionPage=t.isNatoPage=t.isStackOverflow=t.chatFailureMessage=t.metasmokeFailureMessage=t.metasmokeReportedMessage=t.genericBotFailure=t.settingUpBody=t.settingUpTitle=t.popupDelay=t.dayMillis=t.username=t.nattyAllReportsUrl=t.placeholderCopypastorLink=t.placeholderTarget=t.genericBotKey=t.copyPastorServer=t.copyPastorKey=t.metasmokeApiFilter=t.metaSmokeKey=t.soboticsRoomId=void 0,t.soboticsRoomId=111347,t.metaSmokeKey="0a946b9419b5842f99b052d19c956302aa6c6dd5a420b043b20072ad2efc29e0",t.metasmokeApiFilter="GGJFNNKKJFHFKJFLJLGIJMFIHNNJNINJ",t.copyPastorKey="wgixsmuiz8q8px9kyxgwf8l71h7a41uugfh5rkyj",t.copyPastorServer="https://copypastor.sobotics.org",t.genericBotKey="Cm45BSrt51FR3ju",t.placeholderTarget=/\$TARGET\$/g,t.placeholderCopypastorLink=/\$COPYPASTOR\$/g,t.nattyAllReportsUrl="https://logs.sobotics.org/napi/api/stored/all",t.username=$(".top-bar .my-profile .gravatar-wrapper-24").attr("title"),t.dayMillis=864e5,t.popupDelay=4e3,t.settingUpTitle="Setting up MetaSmoke",t.settingUpBody="If you do not wish to connect, press cancel and this popup won't show up again. To reset configuration, see the footer of Stack Overflow.",t.genericBotFailure="Server refused to track the post",t.metasmokeReportedMessage="Post reported to Smokey",t.metasmokeFailureMessage="Failed to report post to Smokey",t.chatFailureMessage="Failed to send message to chat",t.isStackOverflow=Boolean(/^https:\/\/stackoverflow.com/.exec(window.location.href)),t.isNatoPage=Boolean(/\/tools\/new-answers-old-questions/.exec(window.location.href)),t.isQuestionPage=Boolean(/\/questions\/\d+.*/.exec(window.location.href)),t.isFlagsPage=Boolean(/\/users\/flag-summary\//.exec(window.location.href)),t.plainDiv=$("<div>"),t.gridCellDiv=$("<div>").addClass("grid--cell"),t.deletedAnswers="/help/deleted-answers",t.commentHelp="/help/privileges/comment",t.reputationHelp="/help/whats-reputation",t.voteUpHelp="/help/privileges/vote-up",t.whyVote="/help/why-vote",t.setBounties="/help/privileges/set-bounties",t.flagPosts="/help/privileges/flag-posts",t.ConfigurationOpenOnHover="AdvancedFlagging.Configuration.OpenOnHover",t.ConfigurationDefaultNoFlag="AdvancedFlagging.Configuration.DefaultNoFlag",t.ConfigurationDefaultNoComment="AdvancedFlagging.Configuration.DefaultNoComment",t.ConfigurationWatchFlags="AdvancedFlagging.Configuration.WatchFlags",t.ConfigurationWatchQueues="AdvancedFlagging.Configuration.WatchQueues",t.ConfigurationEnabledFlags="AdvancedFlagging.Configuration.EnabledFlags",t.ConfigurationLinkDisabled="AdvancedFlagging.Configuration.LinkDisabled",t.ConfigurationAddAuthorName="AdvancedFlagging.Comments.AddAuthorName",t.CacheChatApiFkey="StackExchange.ChatApi.FKey",t.MetaSmokeUserKeyConfig="MetaSmoke.UserKey",t.MetaSmokeDisabledConfig="MetaSmoke.Disabled",t.FlagTypesKey="FlagTypes",t.displayStacksToast=(e,a)=>StackExchange.helpers.showToast(e,{type:a,transientTimeout:t.popupDelay}),t.attachPopover=async(e,t,a)=>{await Stacks.setTooltipText(e,t,{placement:a})},t.attachHtmlPopover=async(e,t,a)=>{await Stacks.setTooltipHtml(e,t,{placement:a})},t.isReviewItemRegex=/\/review\/(next-task|task-reviewed\/)/,t.isDeleteVoteRegex=/(\d+)\/vote\/10|(\d+)\/recommend-delete/,t.flagsUrlRegex=/flags\/posts\/\d+\/add\/[a-zA-Z]+/,t.getFlagsUrlRegex=e=>new RegExp(`/flags/posts/${e}/add/(AnswerNotAnAnswer|PostOffensive|PostSpam|NoFlag|PostOther|PostLowQuality)`),t.showElement=e=>e.addClass("d-block").removeClass("d-none"),t.hideElement=e=>e.addClass("d-none").removeClass("d-block"),t.showInlineElement=e=>e.addClass("d-inline-block").removeClass("d-none"),t.displaySuccess=e=>o.displayToaster(e,"success"),t.displayError=e=>o.displayToaster(e,"danger"),t.getParamsFromObject=e=>Object.entries(e).map((e=>e.join("="))).join("&"),t.getFormDataFromObject=e=>Object.keys(e).reduce(((t,a)=>(t.append(a,e[a]),t)),new FormData);const n=t.gridCellDiv.clone().addClass("d-none "+(t.isFlagsPage?" ml8":"")).append($("<a>").addClass("s-avatar s-avatar__16 s-user-card--avatar").append($("<img>").addClass("s-avatar--image")));t.nattyIcon=n.clone().find("img").attr("src","https://i.stack.imgur.com/aMUMt.jpg?s=32&g=1").parent().parent(),t.guttenbergIcon=n.clone().find("img").attr("src","https://i.stack.imgur.com/tzKAI.png?s=32&g=1").parent().parent(),t.smokeyIcon=n.clone().find("img").attr("src","https://i.stack.imgur.com/7cmCt.png?s=32&g=1").parent().parent(),t.getMessageDiv=(e,t)=>$("<div>").attr("class","p12 bg-"+t).text(e),t.getSectionWrapper=e=>$("<fieldset>").html(`<h2 class="grid--cell">${e}</h2>`).addClass(`grid gs8 gsy fd-column af-section-${e.toLowerCase()}`),t.getOptionBox=e=>$("<input>").attr("type","checkbox").attr("name",e).attr("id",e).attr("class","s-checkbox"),t.getCategoryDiv=e=>$("<div>").attr("class","advanced-flagging-category bar-md"+(e?" bg-red-200":"")),t.getOptionLabel=(e,t)=>$("<label>").text(e).attr("for",t).addClass("s-label ml4 va-middle fs-body1 fw-normal"),t.getConfigHtml=(e,t)=>$(`\n<div>\n  <div class="grid gs4">\n    <div class="grid--cell"><input class="s-checkbox" type="checkbox" id="${e}"/></div>\n    <label class="grid--cell s-label fw-normal pt2" for="${e}">${t}</label>\n  </div>\n</div>`),t.getTextarea=(e,t)=>$("<textarea>").html(e||"").attr("rows",4).addClass("grid--cell s-textarea fs-body2 "+t);const s=$("<div>").attr("class","grid--cell d-none");t.performedActionIcon=()=>s.clone().append(Svg.Checkmark().addClass("fc-green-500")),t.failedActionIcon=()=>s.clone().append(Svg.Clear().addClass("fc-red-500")),t.reportedIcon=()=>s.clone().append(Svg.Flag().addClass("fc-red-500")),t.divider=$("<hr>").attr("class","my8"),t.popupWrapper=$("<div>").attr("id","snackbar").attr("class","hide fc-white p16 fs-body3 ps-fixed ta-center z-popover l50 t32 wmn2"),t.dropDown=$("<div>").attr("class","advanced-flagging-dialog s-popover s-anchors s-anchors__default p6 mt2 c-default d-none"),t.popoverArrow=$("<div>").attr("class","s-popover--arrow s-popover--arrow__tc"),t.reportLink=$("<a>").attr("class","d-inline-block my4"),t.dropdownItem=$("<div>").attr("class","advanced-flagging-dropdown-item px4"),t.advancedFlaggingLink=$("<button>").attr("type","button").attr("class","s-btn s-btn__link").text("Advanced Flagging"),t.configurationDiv=$("<div>").attr("class","advanced-flagging-configuration-div ta-left pt6"),t.configurationLink=$("<a>").attr("id","af-modal-button").text("AdvancedFlagging configuration"),t.commentsDiv=t.configurationDiv.clone().removeClass("advanced-flagging-configuration-div").addClass("af-comments-div"),t.commentsLink=t.configurationLink.clone().attr("id","af-comments-button").text("AdvancedFlagging: edit comments and flags"),t.editContentWrapper=$("<div>").attr("class","grid grid__fl1 md:fd-column gs16");const r=$("<h2>").attr("class","ta-center mb8 fs-title").text("Comments"),i=$("<h2>").attr("class","ta-center mb8 fs-title").text("Flags");t.commentsWrapper=$("<div>").attr("class","af-comments-content grid--cell w60 md:w100 sm:w100").append(r),t.flagsWrapper=$("<div>").attr("class","af-flags-content grid--cell w40 md:w100 sm:w100").append(i),t.overlayModal=$('\n<aside class="s-modal" id="af-config" role="dialog" aria-hidden="true" data-controller="s-modal" data-target="s-modal.modal">\n  <div class="s-modal--dialog s-modal__full w60 sm:w100 md:w75 lg:w75" role="document">\n    <h1 class="s-modal--header fw-body c-movey" id="af-modal-title">AdvancedFlagging configuration</h1>\n    <div class="s-modal--body fs-body2" id="af-modal-description"></div>\n    <div class="grid gs8 gsx s-modal--footer">\n      <button class="grid--cell s-btn s-btn__primary" type="button">Save changes</button>\n      <button class="grid--cell s-btn" type="button" data-action="s-modal#hide">Cancel</button>\n    </div>\n    <button class="s-modal--close s-btn s-btn__muted" href="#" aria-label="Close" data-action="s-modal#hide"></button>\n  </div>\n</aside>');const l=$("<div>").attr("class","grid lg:grid md:fd-column sm:fd-column");t.inlineCheckboxesWrapper=t.gridCellDiv.clone().addClass("grid--cell lg:grid--cell md:m0 sm:m0").append(l.clone());const d=$('\n<aside class="s-modal" id="af-ms-token" role="dialog" aria-hidden="true" data-controller="s-modal" data-target="s-modal.modal">\n  <div class="s-modal--dialog s-modal__full sm:w100 md:w100" role="document">\n    <h1 class="s-modal--header fw-bold " id="af-modal-title">Authenticate MS with AF</h1>\n    <div class="s-modal--body fs-body2" id="af-modal-description">\n      <div class="grid gs4 gsy fd-column">\n        <div class="grid--cell">\n          <label class="d-block s-label" for="example-item1">Metasmoke access token\n            <p class="s-description mt2">Once you\'ve authenticated Advanced Flagging with metasmoke, you\'ll be given a code; enter it below:</p>\n          </label>\n        </div>\n      <div class="grid ps-relative"><input class="s-input" type="text" id="advanced-flagging-ms-token" placeholder="Enter the code here"></div>\n      </div>\n    </div>\n    <div class="grid gs8 gsx s-modal--footer">\n      <button class="grid--cell s-btn s-btn__primary" id="advanced-flagging-save-ms-token" type="button">Submit</button>\n      <button class="grid--cell s-btn" type="button" data-action="s-modal#hide">Cancel</button>\n    </div>\n    <button class="s-modal--close s-btn s-btn__muted" href="#" aria-label="Close" data-action="s-modal#hide"></button>\n  </div>\n</aside>');async function c(e){return await new Promise((t=>setTimeout(t,e)))}t.editCommentsPopup=$('\n<aside class="s-modal" id="af-comments" role="dialog" aria-hidden="true" data-controller="s-modal" data-target="s-modal.modal">\n  <div class="s-modal--dialog s-modal__full lg:w75 md:w75 sm:w100 w75" role="document">\n    <h1 class="s-modal--header fw-body c-movey" id="af-comments-title">AdvancedFlagging: edit comments and flags</h1>\n    <div class="s-modal--body fs-body2" id="af-comments-description"></div>\n    <div class="grid gs8 gsx s-modal--footer">\n      <button class="grid--cell s-btn s-btn__primary" type="button" data-action="s-modal#hide">I\'m done!</button>\n      <button class="grid--cell s-btn" type="button" data-action="s-modal#hide">Cancel</button>\n    </div>\n    <button class="s-modal--close s-btn s-btn__muted" href="#" aria-label="Close" data-action="s-modal#hide"></button>\n  </div>\n</aside>'),t.showMSTokenPopupAndGet=function(){return new Promise((e=>{StackExchange.helpers.showModal(d),$("#advanced-flagging-save-ms-token").on("click",(()=>{const t=$("#advanced-flagging-ms-token").val();$("#af-ms-token").remove(),t&&e(t.toString())}))}))},t.Delay=c,t.showConfirmModal=async function(e,t){return await StackExchange.helpers.showConfirmModal({title:e,bodyHtml:t,buttonLabel:"Authenticate!"})};let p=!1;const u=[];function m(e){return a.GreaseMonkeyCache.GetFromCache(t.FlagTypesKey)?.find((t=>t.Id===e))||null}t.addXHRListener=function(e){if(u.push(e),p)return;const t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(...e){this.addEventListener("load",(()=>{u.forEach((e=>e(this)))}),!1),t.apply(this,e)},p=!0},t.getAllPostIds=function(e,a){return $(t.isQuestionPage?".question, .answer":".flagged-post").get().map((o=>{const n=$(o),s=(t.isQuestionPage?n.attr("data-questionid"):n.find(".question-hyperlink").length)?"Question":"Answer";if(!e&&"Question"===s)return 0;const r=n.find(`.${s.toLowerCase()}-hyperlink`).attr("href");let i;return i=Number(r?"Answer"===s?r.split("#")[1]:r.split("/")[2]:n.attr("data-questionid")||n.attr("data-answerid")),a?`//${window.location.hostname}/${"Answer"===s?"a":"questions"}/${i}`:i})).filter(String)},t.getFullComment=function(e,{AuthorName:o},n){const s=a.GreaseMonkeyCache.GetFromCache(t.ConfigurationAddAuthorName),r=m(e)?.Comments[n||"Low"];return(r&&s?`${o}, ${r[0].toLowerCase()}${r.slice(1)}`:r)||""},t.getFullFlag=function(e,a,o){const n=m(e)?.FlagText;return n?n.replace(t.placeholderTarget,a).replace(t.placeholderCopypastorLink,(e=>`https://copypastor.sobotics.org/posts/${e}`)(o)):""},t.qualifiesForVlq=function(e,a){return e<=0&&(new Date).valueOf()-a.valueOf()<t.dayMillis},t.parseDate=function(e){return e?new Date(e.replace(" ","T")):null},t.getSentMessage=function(e,t,a){return e?`Feedback ${t} sent to ${a}`:`Failed to send feedback ${t} to ${a}`},t.getFlagTypeFromCache=m,t.getReportType=function(e){return a.GreaseMonkeyCache.GetFromCache(t.FlagTypesKey)?.find((t=>t.Id===e))?.ReportType||""},t.getFlagText=function(e){return a.GreaseMonkeyCache.GetFromCache(t.FlagTypesKey)?.find((t=>t.Id===e))?.FlagText||""},t.getComments=function(e){return a.GreaseMonkeyCache.GetFromCache(t.FlagTypesKey)?.find((t=>t.Id===e))?.Comments||""},t.saveCommentsToCache=function(e,o){const n=a.GreaseMonkeyCache.GetFromCache(t.FlagTypesKey),s=n?.find((t=>t.Id===e));n&&s&&(s.Comments=o,a.GreaseMonkeyCache.StoreInCache(t.FlagTypesKey,n))},t.savePropertyToCache=function(e,o,n){const s=a.GreaseMonkeyCache.GetFromCache(t.FlagTypesKey),r=s?.find((t=>t.Id===e));s&&r&&(r[o]=n,a.GreaseMonkeyCache.StoreInCache(t.FlagTypesKey,s))},t.waitForSvg=async function(){for(;"undefined"==typeof Svg;)await c(1e3)}}.apply(t,o))||(e.exports=n)},563:(e,t,a)=>{var o,n;o=[a,t,a(769),a(216)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatApi=void 0;class n{constructor(e="https://chat.stackoverflow.com"){this.chatRoomUrl=e}static GetExpiryDate(){const e=new Date;return e.setDate(e.getDate()+1),e}GetChannelFKey(e){const t=n.GetExpiryDate();return a.GreaseMonkeyCache.GetAndCache(o.CacheChatApiFkey,(async()=>{try{const t=await this.GetChannelPage(e);return $(t).filter("#fkey").val()?.toString()||""}catch(e){throw console.error(e),new Error("Failed to get chat fkey")}}),t)}GetChatUserId(){return StackExchange.options.user.userId}async SendMessage(e,t,n=o.soboticsRoomId){const s=async()=>await this.SendRequestToChat(e,n);let r=0;const i=async()=>{if(r++,!(r<3))throw new Error(o.chatFailureMessage);return a.GreaseMonkeyCache.Unset(o.CacheChatApiFkey),await s()?o.getSentMessage(!0,e.split(" ").pop()||"",t):i()};return await s()?o.getSentMessage(!0,e.split(" ").pop()||"",t):i()}async SendRequestToChat(e,t){const a=await this.GetChannelFKey(t);return new Promise((o=>{GM_xmlhttpRequest({method:"POST",url:`${this.chatRoomUrl}/chats/${t}/messages/new`,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"text="+encodeURIComponent(e)+"&fkey="+a,onload:e=>{o(200===e.status)},onerror:()=>o(!1)})}))}GetChannelPage(e){return new Promise(((t,a)=>{GM_xmlhttpRequest({method:"GET",url:`${this.chatRoomUrl}/rooms/${e}`,onload:e=>{200===e.status?t(e.responseText):a()},onerror:()=>a()})}))}}t.ChatApi=n}.apply(t,o))||(e.exports=n)},232:(e,t,a)=>{var o,n;o=[a,t,a(563),a(216)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyPastorAPI=void 0;class n{constructor(e){this.name="Guttenberg",this.answerId=e}static async getAllCopyPastorIds(){if(!o.isStackOverflow)return;const e=o.getAllPostIds(!1,!0);await this.storeReportedPosts(e)}static storeReportedPosts(e){const t=`${o.copyPastorServer}/posts/findTarget?url=${e.join(",")}`;return new Promise(((e,a)=>{GM_xmlhttpRequest({method:"GET",url:t,onload:t=>{const a=JSON.parse(t.responseText);"failure"!==a.status&&(a.posts.forEach((e=>{this.copyPastorIds.push({postId:Number(e.post_id),repost:e.repost,target_url:e.target_url})})),e())},onerror:()=>a()})}))}getCopyPastorId(){return n.copyPastorIds.find((e=>e.postId===this.answerId))?.postId||0}getIsRepost(){return n.copyPastorIds.find((e=>e.postId===this.answerId))?.repost||!1}getTargetUrl(){return n.copyPastorIds.find((e=>e.postId===this.answerId))?.target_url||""}async ReportTruePositive(){return await this.SendFeedback("tp")}async ReportFalsePositive(){return await this.SendFeedback("fp")}async ReportNaa(){return await this.ReportFalsePositive()}ReportRedFlag(){return Promise.resolve("")}async ReportLooksFine(){return await this.ReportFalsePositive()}async ReportNeedsEditing(){return await this.ReportFalsePositive()}async ReportVandalism(){return await this.ReportFalsePositive()}async ReportDuplicateAnswer(){return await this.ReportTruePositive()}async ReportPlagiarism(){return await this.ReportTruePositive()}SendFeedback(e){const t=(new a.ChatApi).GetChatUserId(),n=this.getCopyPastorId();if(!n)return Promise.resolve("");const s=o.getSentMessage(!0,e,this.name),r=o.getSentMessage(!1,e,this.name),i={post_id:n,feedback_type:e,username:o.username,link:`https://chat.stackoverflow.com/users/${t}`,key:o.copyPastorKey};return new Promise(((e,t)=>{GM_xmlhttpRequest({method:"POST",url:`${o.copyPastorServer}/feedback/create`,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:Object.entries(i).map((e=>e.join("="))).join("&"),onload:a=>{200===a.status?e(s):t(r)},onerror:()=>t(r)})}))}}t.CopyPastorAPI=n,n.copyPastorIds=[]}.apply(t,o))||(e.exports=n)},779:(e,t,a)=>{var o,n;o=[a,t,a(216)],void 0===(n=function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericBotAPI=void 0,t.GenericBotAPI=class{constructor(e){this.name="Generic Bot",this.answerId=e}async ReportNaa(){return await this.makeTrackRequest()}async ReportRedFlag(){return await this.makeTrackRequest()}ReportLooksFine(){return Promise.resolve("")}ReportNeedsEditing(){return Promise.resolve("")}ReportVandalism(){return Promise.resolve("")}ReportDuplicateAnswer(){return Promise.resolve("")}ReportPlagiarism(){return Promise.resolve("")}computeContentHash(e){if(!e)return 0;let t=0;for(let a=0;a<e.length;++a)t=(t<<5)-t+e.charCodeAt(a),t&=t;return t}makeTrackRequest(){return new Promise(((e,t)=>{const o=encodeURIComponent(a.username||"");a.isStackOverflow&&o||e("");const n=this.computeContentHash($(`#answer-${this.answerId} .js-post-body`).html().trim());GM_xmlhttpRequest({method:"POST",url:"https://so.floern.com/api/trackpost.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:`key=${a.genericBotKey}&postId=${this.answerId}&contentHash=${n}&flagger=${o}`,onload:o=>{200!==o.status&&(console.error("Failed to send track request.",o),t(a.genericBotFailure)),e(a.getSentMessage(!0,"",this.name))},onerror:()=>t(a.genericBotFailure)})}))}}}.apply(t,o))||(e.exports=n)},769:(e,t,a)=>{var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GreaseMonkeyCache=void 0;class a{static async GetAndCache(e,t,o){const n=a.GetFromCache(e);if(n)return n;const s=await t();return a.StoreInCache(e,s,o),s}static GetFromCache(e){const t=GM_getValue(e,null);if(!t)return null;const a=JSON.parse(t);return a.Expires&&new Date(a.Expires)<new Date?null:a.Data}static StoreInCache(e,t,a){const o=JSON.stringify({Expires:a,Data:t});GM_setValue(e,o)}static Unset(e){GM_deleteValue(e)}}t.GreaseMonkeyCache=a}.apply(t,[a,t]))||(e.exports=o)},451:(e,t,a)=>{var o,n;o=[a,t,a(769),a(216)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetaSmokeAPI=void 0;class n{constructor(e,t){this.name="Smokey",this.postId=e,this.postType=t}static Reset(){a.GreaseMonkeyCache.Unset(o.MetaSmokeDisabledConfig),a.GreaseMonkeyCache.Unset(o.MetaSmokeUserKeyConfig)}static async Setup(e){n.appKey=e,n.accessToken=await n.getUserKey()}static async QueryMetaSmokeInternal(){const e=o.getAllPostIds(!0,!0).join(",");if(n.isDisabled)return;const t=o.getParamsFromObject({urls:e,key:`${n.appKey}`,per_page:1e3,filter:o.metasmokeApiFilter});try{const e=await fetch(`https://metasmoke.erwaysoftware.com/api/v2.0/posts/urls?${t}`);(await e.json()).items.forEach((e=>{const t=/\d+$/.exec(e.link);t&&n.metasmokeIds.push({sitePostId:Number(t[0]),metasmokeId:e.id})}))}catch(e){o.displayError("Failed to get Metasmoke URLs."),console.error(e)}}static GetQueryUrl(e,t){return`//${window.location.hostname}/${"Answer"===t?"a":"questions"}/${e}`}static async getUserKey(){for(;void 0===StackExchange.helpers.showConfirmModal;)await o.Delay(100);return await a.GreaseMonkeyCache.GetAndCache(o.MetaSmokeUserKeyConfig,(async()=>{const e=`https://metasmoke.erwaysoftware.com/oauth/request?key=${n.appKey}`,t=await n.codeGetter(e);if(!t)return"";const a=await fetch(`https://metasmoke.erwaysoftware.com/oauth/token?key=${n.appKey}&code=${t}`);return(await a.json()).token}))}static getSmokeyId(e){return n.metasmokeIds.find((t=>t.sitePostId===e))?.metasmokeId||0}async ReportNaa(){return await this.SendFeedback("naa-")}async ReportRedFlag(){const e=n.getSmokeyId(this.postId);if(e)return await this.SendFeedback("tpu-");const t=n.GetQueryUrl(this.postId,this.postType);if(!n.accessToken)return"";const a=await fetch("https://metasmoke.erwaysoftware.com/api/w/post/report",{method:"POST",body:o.getFormDataFromObject({post_link:t,key:n.appKey,token:n.accessToken})}),s=await a.text();if(!a.ok||"OK"!==s)throw console.error(`Failed to report post to Smokey (postId: ${e})`,s),new Error(o.metasmokeFailureMessage);return o.metasmokeReportedMessage}async ReportLooksFine(){return await this.SendFeedback("fp-")}async ReportNeedsEditing(){return await this.SendFeedback("fp-")}async ReportVandalism(){return await this.SendFeedback("tp-")}ReportDuplicateAnswer(){return Promise.resolve("")}ReportPlagiarism(){return Promise.resolve("")}async SendFeedback(e){const t=n.getSmokeyId(this.postId);if(!n.accessToken||!t)return"";const a=await fetch(`https://metasmoke.erwaysoftware.com/api/w/post/${t}/feedback`,{method:"POST",body:o.getFormDataFromObject({type:e,key:n.appKey,token:n.accessToken})}),s=await a.json();if(!a.ok)throw console.error(`Failed to send feedback to Smokey (postId: ${t})`,s),new Error(o.getSentMessage(!1,e,this.name));return o.getSentMessage(!0,e,this.name)}}t.MetaSmokeAPI=n,n.metasmokeIds=[],n.isDisabled=a.GreaseMonkeyCache.GetFromCache(o.MetaSmokeDisabledConfig)||!1,n.codeGetter=async e=>{if(!n.isDisabled)return await o.showConfirmModal(o.settingUpTitle,o.settingUpBody)?(window.open(e,"_blank"),await o.Delay(100),await o.showMSTokenPopupAndGet()):void a.GreaseMonkeyCache.StoreInCache(o.MetaSmokeDisabledConfig,!0)}}.apply(t,o))||(e.exports=n)},26:(e,t,a)=>{var o,n;o=[a,t,a(563),a(216)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NattyAPI=void 0;class n{constructor(e,t,o){this.chat=new a.ChatApi,this.name="Natty",this.answerId=e,this.questionDate=t,this.answerDate=o,this.feedbackMessage=`@Natty feedback https://stackoverflow.com/a/${this.answerId}`,this.reportMessage=`@Natty report https://stackoverflow.com/a/${this.answerId}`}static getAllNattyIds(){return new Promise(((e,t)=>{o.isStackOverflow||e(),GM_xmlhttpRequest({method:"GET",url:`${o.nattyAllReportsUrl}`,onload:a=>{200!==a.status&&t();const n=JSON.parse(a.responseText).items.map((e=>Number(e.name))),s=o.getAllPostIds(!1,!1);this.nattyIds=s.filter((e=>n.includes(e))),e()},onerror:()=>t()})}))}WasReported(){return n.nattyIds.includes(this.answerId)}async ReportNaa(){if(this.answerDate<this.questionDate)return"";if(this.WasReported())return await this.chat.SendMessage(`${this.feedbackMessage} tp`,this.name);{const e=this.DaysBetween(this.answerDate,new Date),t=this.DaysBetween(this.questionDate,this.answerDate);return isNaN(e)||isNaN(t)||e>30||t<30?"":isNaN(e+t)?await this.chat.SendMessage(this.reportMessage,this.name):""}}async ReportRedFlag(){return await this.SendFeedback(`${this.feedbackMessage} tp`)}async ReportLooksFine(){return await this.SendFeedback(`${this.feedbackMessage} fp`)}async ReportNeedsEditing(){return await this.SendFeedback(`${this.feedbackMessage} ne`)}ReportVandalism(){return Promise.resolve("")}ReportDuplicateAnswer(){return Promise.resolve("")}ReportPlagiarism(){return Promise.resolve("")}DaysBetween(e,t){return(t.valueOf()-e.valueOf())/o.dayMillis}async SendFeedback(e){return this.WasReported()?await this.chat.SendMessage(e,this.name):""}}t.NattyAPI=n,n.nattyIds=[]}.apply(t,o))||(e.exports=n)},436:(e,t,a)=>{var o,n;o=[a,t,a(216)],void 0===(n=function(e,t,a){"use strict";function o(e){return{score:Number(e.find(".js-vote-count").text()),authorReputation:r(e.find(".user-info .reputation-score").last()),authorName:i(e.find(".user-info .user-details").last()),creationDate:l(e.find(".user-info .relativetime").last())}}function n(e,t,a){const s=e.attr("data-answerid");if(!s)return;const r=Number(s),i=o(e);i.creationDate&&(e.find(".answercell").on("destroyed",(()=>{setTimeout((()=>{n($(`#answer-${r}`),t,a)}))})),t({type:"Answer",element:e,page:"Question",postId:r,questionTime:a,creationDate:i.creationDate,score:i.score,authorReputation:i.authorReputation,authorName:i.authorName}))}function s(e){let t;const a=n=>{const s=n.attr("data-questionid");if(!s)return;const r=Number(s),i=o(n);i.creationDate&&(n.find(".postcell").on("destroyed",(()=>{setTimeout((()=>{const e=$(`[data-questionid="${r}"]`);a(e)}))})),e(t={type:"Question",element:n,page:"Question",postId:r,creationDate:i.creationDate,score:i.score,authorReputation:i.authorReputation,authorName:i.authorName}))},s=$(".question");a(s),$(".answer").each(((a,o)=>n($(o),e,t.creationDate)))}function r(e){let t=e.text();const a=e.attr("title");return a?(-1!==t.indexOf("k")&&(t=a.substr("reputation score ".length)),t=t.replace(",",""),Number(t)):0}function i(e){return e.find("a").text()}function l(e){return a.parseDate((e.hasClass("relativetime")?e:e.find(".relativeTime")).attr("title"))}Object.defineProperty(t,"__esModule",{value:!0}),t.parseQuestionsAndAnswers=void 0,$.event.special.destroyed={remove:e=>{e.handler&&e.handler()}},t.parseQuestionsAndAnswers=function(e){a.isNatoPage?function(e){$(".answer-hyperlink").parent().parent().each(((t,a)=>{const o=$(a),n=o.find(".answer-hyperlink").attr("href");if(!n)return;const s=Number(n.split("#")[1]),d=l(o.find(".user-action-time")),c=l(o.find("td .relativetime"));if(!d||!c)return;const p=r(o.find(".reputation-score")),u=i(o.find(".user-details"));e({type:"Answer",element:o,page:"NATO",postId:s,creationDate:d,questionTime:c,authorReputation:p,authorName:u})}))}(e):a.isQuestionPage?s(e):a.isFlagsPage&&function(e){$(".flagged-post").each(((t,a)=>{const o=$(a),n=o.find(".answer-hyperlink").length?"Answer":"Question",s=o.find(`.${n.toLowerCase()}-hyperlink`).attr("href");if(!s)return;const r=Number("Answer"===n?s.split("#")[1]:s.split("/")[2]),d=i(o.find(".post-user-info")),c=l(o.find(".post-user-info .relativetime"));c&&e({type:n,element:o,page:"Flags",postId:r,creationDate:c,authorName:d,questionTime:null})}))}(e)}}.apply(t,o))||(e.exports=n)}},t={};!function a(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,a),s.exports}(422)})();