// ==UserScript==
// @name         Advanced Flagging
// @namespace    https://github.com/SOBotics
// @version      0.5.61
// @author       Robert Rudman
// @match        *://*.stackexchange.com/*
// @match        *://*.stackoverflow.com/*
// @match        *://*.superuser.com/*
// @match        *://*.serverfault.com/*
// @match        *://*.askubuntu.com/*
// @match        *://*.stackapps.com/*
// @match        *://*.mathoverflow.net/*
// @exclude      *://chat.stackexchange.com/*
// @exclude      *://chat.meta.stackexchange.com/*
// @exclude      *://chat.stackoverflow.com/*
// @exclude      *://blog.stackoverflow.com/*
// @exclude      *://*.area51.stackexchange.com/*
// @require      https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js
// @grant        GM_xmlhttpRequest
// ==/UserScript==
!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=11)}([function(e,t,n){"use strict";function r(e,t){function n(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]]);return n}function i(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function s(e,t){return function(n,r){t(n,r,e)}}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})}function u(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function p(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function l(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function f(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(f(arguments[t]));return e}function d(e){return this instanceof d?(this.v=e,this):new d(e)}function v(e,t,n){function r(e){p[e]&&(u[e]=function(t){return new Promise(function(n,r){l.push([e,t,n,r])>1||o(e,t)})})}function o(e,t){try{i(p[e](t))}catch(e){c(l[0][3],e)}}function i(e){e.value instanceof d?Promise.resolve(e.value.v).then(s,a):c(l[0][2],e)}function s(e){o("next",e)}function a(e){o("throw",e)}function c(e,t){e(t),l.shift(),l.length&&o(l[0][0],l[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,p=n.apply(e,t||[]),l=[];return u={},r("next"),r("throw"),r("return"),u[Symbol.asyncIterator]=function(){return this},u}function m(e){function t(t,o){e[t]&&(n[t]=function(n){return(r=!r)?{value:d(e[t](n)),done:"return"===t}:o?o(n):n})}var n,r;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n}function y(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof l?l(e):e[Symbol.iterator]()}function b(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}Object.defineProperty(t,"__esModule",{value:!0}),t.__extends=r,n.d(t,"__assign",function(){return g}),t.__rest=o,t.__decorate=i,t.__param=s,t.__metadata=a,t.__awaiter=c,t.__generator=u,t.__exportStar=p,t.__values=l,t.__read=f,t.__spread=h,t.__await=d,t.__asyncGenerator=v,t.__asyncDelegator=m,t.__asyncValues=y,t.__makeTemplateObject=b;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},g=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}},function(e,t,n){"use strict";var r=n(6),o=n(23),i=n(28),s=n(29),a=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,i=o.toSubscriber(e,t,n);if(r?r.call(i,this.source):i.add(this.source?this._subscribe(i):this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var n=this;if(t||(r.root.Rx&&r.root.Rx.config&&r.root.Rx.config.Promise?t=r.root.Rx.config.Promise:r.root.Promise&&(t=r.root.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,r){var o;o=n.subscribe(function(t){if(o)try{e(t)}catch(e){r(e),o.unsubscribe()}else e(t)},r,t)})},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[i.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 0===e.length?this:s.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;if(e||(r.root.Rx&&r.root.Rx.config&&r.root.Rx.config.Promise?e=r.root.Rx.config.Promise:r.root.Promise&&(e=r.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();t.Observable=a},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(13),i=n(4),s=n(15),a=n(8),c=function(e){function t(n,r,o){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=s.empty;break;case 1:if(!n){this.destination=s.empty;break}if("object"==typeof n){n instanceof t?(this.destination=n,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new u(this,n));break}default:this.syncErrorThrowable=!0,this.destination=new u(this,n,r,o)}}return r(t,e),t.prototype[a.rxSubscriber]=function(){return this},t.create=function(e,n,r){var o=new t(e,n,r);return o.syncErrorThrowable=!1,o},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this,t=e._parent,n=e._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=n,this},t}(i.Subscription);t.Subscriber=c;var u=function(e){function t(t,n,r,i){e.call(this),this._parentSubscriber=t;var a,c=this;o.isFunction(n)?a=n:n&&(a=n.next,r=n.error,i=n.complete,n!==s.empty&&(c=Object.create(n),o.isFunction(c.unsubscribe)&&this.add(c.unsubscribe.bind(c)),c.unsubscribe=this.unsubscribe.bind(this))),this._context=c,this._next=a,this._error=r,this._complete=i}return r(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}},t.prototype.__tryOrSetError=function(e,t,n){try{t.call(this._context,n)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(c)},function(e,t,n){var r,o;r=[n,t,n(0)],void 0!==(o=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.GetAndCache=function(t,r,o){return n.__awaiter(this,void 0,void 0,function(){var i,s;return n.__generator(this,function(n){switch(n.label){case 0:return i=e.GetFromCache(t),void 0!==i?[2,i]:[4,r()];case 1:return s=n.sent(),e.StoreInCache(t,s,o),[2,s]}})})},e.ClearCache=function(){localStorage.clear()},e.ClearExpiredKeys=function(e){for(var t=localStorage.length,n=t-1;n>=0;n--)!function(t){var n=localStorage.key(t);if(n&&(!e||e.filter(function(e){return n.match(e)}).length>0)){var r=localStorage.getItem(n);if(r)try{var o=JSON.parse(r);o.Expires&&new Date(o.Expires)<new Date&&localStorage.removeItem(n)}catch(e){}}}(n)},e.ClearAll=function(e,t){for(var n=localStorage.length,r=n-1;r>=0;r--)!function(n){var r=localStorage.key(n);if(r&&e.filter(function(e){return r.match(e)}).length>0)if(t){var o=localStorage.getItem(r);t(o)&&localStorage.removeItem(r)}else localStorage.removeItem(r)}(r)},e.GetFromCache=function(e){var t=localStorage.getItem(e);if(t){var n=JSON.parse(t);if(!(n.Expires&&new Date(n.Expires)<new Date))return n.Data}},e.StoreInCache=function(e,t,n){var r=JSON.stringify({Expires:n,Data:t});localStorage.setItem(e,r)},e.Unset=function(e){localStorage.removeItem(e)},e}();t.SimpleCache=r}.apply(t,r))&&(e.exports=o)},function(e,t,n){"use strict";function r(e){return e.reduce(function(e,t){return e.concat(t instanceof u.UnsubscriptionError?t.errors:t)},[])}var o=n(24),i=n(25),s=n(13),a=n(26),c=n(14),u=n(27),p=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this,p=n._parent,l=n._parents,f=n._unsubscribe,h=n._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var d=-1,v=l?l.length:0;p;)p.remove(this),p=++d<v&&l[d]||null;if(s.isFunction(f)){var m=a.tryCatch(f).call(this);m===c.errorObject&&(t=!0,e=e||(c.errorObject.e instanceof u.UnsubscriptionError?r(c.errorObject.e.errors):[c.errorObject.e]))}if(o.isArray(h))for(d=-1,v=h.length;++d<v;){var y=h[d];if(i.isObject(y)){var m=a.tryCatch(y.unsubscribe).call(y);if(m===c.errorObject){t=!0,e=e||[];var b=c.errorObject.e;b instanceof u.UnsubscriptionError?e=e.concat(r(b.errors)):e.push(b)}}}if(t)throw new u.UnsubscriptionError(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;n=new e,n._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this,n=t._parent,r=t._parents;n&&n!==e?r?-1===r.indexOf(e)&&r.push(e):this._parents=[e]:this._parent=e},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();t.Subscription=p},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(1),i=n(2),s=n(4),a=n(16),c=n(17),u=n(8),p=function(e){function t(t){e.call(this,t),this.destination=t}return r(t,e),t}(i.Subscriber);t.SubjectSubscriber=p;var l=function(e){function t(){e.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return r(t,e),t.prototype[u.rxSubscriber]=function(){return new p(this)},t.prototype.lift=function(e){var t=new f(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),o=0;o<n;o++)r[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),o=0;o<n;o++)r[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new a.ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new a.ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),s.Subscription.EMPTY):this.isStopped?(e.complete(),s.Subscription.EMPTY):(this.observers.push(e),new c.SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new o.Observable;return e.source=this,e},t.create=function(e,t){return new f(e,t)},t}(o.Observable);t.Subject=l;var f=function(e){function t(t,n){e.call(this),this.destination=t,this.source=n}return r(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):s.Subscription.EMPTY},t}(l);t.AnonymousSubject=f},function(e,t,n){"use strict";var r="undefined"!=typeof window&&window,o="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,i="undefined"!=typeof global&&global,s=r||i||o;t.root=s,function(){if(!s)throw new Error("RxJS could not find any global context (window, self, global)")}()},function(e,t,n){var r,o;r=[n,t],void 0!==(o=function(e,t){"use strict";function n(){return!!window.location.href.match(/^https:\/\/stackoverflow.com/)}function r(){return!!window.location.href.match(/\/tools\/new-answers-old-questions/)}function o(e){for(var t=$(".answer-hyperlink").parent().parent(),n=0;n<t.length;n++){var r=$(t[n]),o=parseInt(r.find(".answer-hyperlink").attr("href").split("#")[1],10),i=h(r.find(".user-action-time")),s=h(r.find("td .relativetime")),a=l(r.find(".reputation-score")),c=f(r.find(".user-details"));e({type:"Answer",element:r,page:"NATO",postId:o,answerTime:i,questionTime:s,authorReputation:a,authorName:c.authorName,authorId:c.authorId})}}function i(){return!!window.location.href.match(/\/questions\/\d+.*/)}function s(e){function t(e){var t=parseInt(e.find(".vote-count-post").text(),10),n=l(e.find(".post-signature .reputation-score").last()),r=f(e.find(".post-signature .user-details").last());return{score:t,authorReputation:n,authorName:r.authorName,authorId:r.authorId,postTime:h(e.find(".post-signature .relativetime").last())}}var n,r=function(o){var i=parseInt(o.attr("data-questionid"),10),s=t(o);o.find(".postcell").bind("destroyed",function(){setTimeout(function(){var e=$('[data-questionid="'+i+'"]');r(e)})}),n={type:"Question",element:o,page:"Question",postId:i,postTime:s.postTime,score:s.score,authorReputation:s.authorReputation,authorName:s.authorName,authorId:s.authorId},e(n)},o=$(".question");r(o);for(var i=$(".answer"),s=0;s<i.length;s++)!function(r){var o=function(r){var i=parseInt(r.attr("data-answerid"),10),s=t(r);r.find(".answercell").bind("destroyed",function(){setTimeout(function(){var e=$("#answer-"+i);o(e)})}),e({type:"Answer",element:r,page:"Question",postId:i,question:n,postTime:s.postTime,score:s.score,authorReputation:s.authorReputation,authorName:s.authorName,authorId:s.authorId})},s=$(i[r]);o(s)}(s)}function a(){return!!window.location.href.match(/\/users\/flag-summary\//)}function c(e){for(var t=$(".flagged-post"),n=0;n<t.length;n++){var r=$(t[n]),o=r.find(".answer-hyperlink").length?"Answer":"Question",i=parseInt("Answer"===o?r.find(".answer-hyperlink").attr("href").split("#")[1]:r.find(".question-hyperlink").attr("href").split("/")[2],10),s=parseInt(r.find(".answer-votes").text(),10),a=f(r.find(".post-user-info")),c=a.authorName,u=a.authorId,p=h(r.find(".post-user-info .relativetime")),l=h(r.find(".mod-flag .relativetime")),d=r.find(".flag-outcome").text().trim().split(" - ");e({type:o,element:r,page:"Flags",postId:i,score:s,postTime:p,handledTime:l,handledResult:d[0].trim(),handledComment:d.slice(1).join(" - ").trim(),authorName:c,authorId:u})}}function u(e){for(var t=$(".question-hyperlink"),n=0;n<t.length;n++){var r=$(t[n]),o=r.attr("href").split("/")[2];o.indexOf("_")>=0&&(o=o.split("_")[1]);var i=parseInt(o,10);e({type:"Question",element:r,page:"Unknown",postId:i})}for(var s=$(".answer-hyperlink"),n=0;n<s.length;n++){var a=$(s[n]),o=a.attr("href").split("#")[1];o.indexOf("_")>=0&&(o=o.split("_")[1]);var i=parseInt(o,10);e({type:"Answer",element:a,page:"Unknown",postId:i})}}function p(e){return r()?void o(e):i()?void s(e):a()?void c(e):void u(e)}function l(e){var t=e.text();if(-1!==t.indexOf("k")&&(t=e.attr("title").substr("reputation score ".length)),t=t.replace(",",""),""!==t.trim())return parseInt(t,10)}function f(e){var t,n=e.find("a"),r=n.text(),o=n.attr("href");return o&&(t=parseInt(o.split("/")[2],10)),{authorName:r,authorId:t}}function h(e){return e.hasClass("relativetime")||(e=e.find(".relativetime")),d(e.attr("title"))}function d(e){return new Date(e.replace(" ","T"))}Object.defineProperty(t,"__esModule",{value:!0}),$.event.special.destroyed={remove:function(e){e.handler&&e.handler()}},t.IsStackOverflow=n,t.isNatoPage=r,t.isQuestionPage=i,t.isFlagsPage=a,t.parseQuestionsAndAnswers=p,t.parseDate=d}.apply(t,r))&&(e.exports=o)},function(e,t,n){"use strict";var r=n(6),o=r.root.Symbol;t.rxSubscriber="function"==typeof o&&"function"==typeof o.for?o.for("rxSubscriber"):"@@rxSubscriber",t.$$rxSubscriber=t.rxSubscriber},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(5),i=n(31),s=n(4),a=n(38),c=n(16),u=n(17),p=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY),e.call(this),this.scheduler=r,this._events=[],this._bufferSize=t<1?1:t,this._windowTime=n<1?1:n}return r(t,e),t.prototype.next=function(t){var n=this._getNow();this._events.push(new l(n,t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._trimBufferThenGetEvents(),r=this.scheduler;if(this.closed)throw new c.ObjectUnsubscribedError;this.hasError?t=s.Subscription.EMPTY:this.isStopped?t=s.Subscription.EMPTY:(this.observers.push(e),t=new u.SubjectSubscription(this,e)),r&&e.add(e=new a.ObserveOnSubscriber(e,r));for(var o=n.length,i=0;i<o&&!e.closed;i++)e.next(n[i].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||i.queue).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,o=r.length,i=0;i<o&&!(e-r[i].time<n);)i++;return o>t&&(i=Math.max(i,o-t)),i>0&&r.splice(0,i),r},t}(o.Subject);t.ReplaySubject=p;var l=function(){function e(e,t){this.time=e,this.value=t}return e}()},function(e,t,n){var r,o;r=[n,t,n(0),n(44)],void 0!==(o=function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.InitializeCache=function(t){var n=this;e.xdLocalStorageInitialized=new Promise(function(e,o){try{r.XdLocalStorage.init({iframeUrl:t,initCallback:function(){n.cacheFailed=!1,e()}})}catch(t){n.cacheFailed=!0,e()}})},e.GetAndCache=function(e,t,r){return n.__awaiter(this,void 0,void 0,function(){var o,i;return n.__generator(this,function(n){switch(n.label){case 0:return[4,this.GetFromCache(e)];case 1:return o=n.sent(),void 0!==o?[2,o]:[4,t()];case 2:return i=n.sent(),this.StoreInCache(e,i,r),[2,i]}})})},e.ClearCache=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return[4,e.AwaitInitialization()];case 1:return t.sent(),[4,e.CacheFailed()];case 2:return t.sent()?[2]:(r.XdLocalStorage.clear(),[2])}})})},e.GetFromCache=function(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.AwaitInitialization()];case 1:return n.sent(),[4,e.CacheFailed()];case 2:return n.sent()?[2,void 0]:[2,new Promise(function(e,n){r.XdLocalStorage.getItem(t,function(t){void 0===t.value&&e();var n=JSON.parse(t.value);return null===n||n.Expires&&new Date(n.Expires)<new Date?void e():e(n.Data)})})]}})})},e.StoreInCache=function(t,o,i){return n.__awaiter(this,void 0,void 0,function(){var s;return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.AwaitInitialization()];case 1:return n.sent(),[4,e.CacheFailed()];case 2:return n.sent()?[2]:(s=JSON.stringify({Expires:i,Data:o}),[2,new Promise(function(e,n){r.XdLocalStorage.setItem(t,s,function(){e()})})])}})})},e.Unset=function(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.AwaitInitialization()];case 1:return n.sent(),[4,e.CacheFailed()];case 2:return n.sent()?[2]:[2,new Promise(function(e,n){r.XdLocalStorage.removeItem(t,function(){e()})})]}})})},e.CacheFailed=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return[4,e.AwaitInitialization()];case 1:return t.sent(),[2,this.cacheFailed]}})})},e.AwaitInitialization=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:if(null===e.xdLocalStorageInitialized)throw Error("Cache must be initialized before use");return[4,e.xdLocalStorageInitialized];case 1:return t.sent(),[2]}})})},e}();t.CrossDomainCache=o}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(0),n(12),n(3),n(7),n(22),n(21),n(20),n(10),n(45),n(49),n(53)],void 0!==(o=function(e,t,n,r,o,i,s,a,c,u,p,l,f){"use strict";function h(){var e=document.createElement("style");e.type="text/css",e.textContent="\n#snackbar {\n    min-width: 250px;\n    margin-left: -125px;\n    color: #fff;\n    text-align: center;\n    border-radius: 2px;\n    padding: 16px;\n    position: fixed;\n    z-index: 2000;\n    left: 50%;\n    top: 30px;\n    font-size: 17px;\n}\n\n#snackbar.show {\n    opacity: 1;\n    transition: opacity 1s ease-out;\n    -ms-transition: opacity 1s ease-out;\n    -moz-transition: opacity 1s ease-out;\n    -webkit-transition: opacity 1s ease-out;\n}\n\n#snackbar.hide {\n    opacity: 0;\n    transition: opacity 1s ease-in;\n    -ms-transition: opacity 1s ease-in;\n    -moz-transition: opacity 1s ease-in;\n    -webkit-transition: opacity 1s ease-in;\n}\n",(document.getElementsByTagName("head")[0]||document.body||document.documentElement).appendChild(e)}function d(e,t,n,r,i){var s={};if(r&&(s.CommentPromise=new Promise(function(t,n){$.ajax({url:"//stackoverflow.com/posts/"+e+"/comments",type:"POST",data:{fkey:StackExchange.options.user.fkey,comment:r}}).done(function(e){t(e)}).fail(function(e,t,r){n({jqXHR:e,textStatus:t,errorThrown:r})})})),n&&"NoFlag"!==t.ReportType){o.SimpleCache.GetFromCache("AdvancedFlagging.Flagged."+e)||("PostOther"===t.ReportType?s.FlagPromise=new Promise(function(n,r){i.then(function(o){if(t.GetCustomFlagText&&o.length>0){var i=t.GetCustomFlagText(o[0]);D=!0,$.ajax({url:"//"+window.location.hostname+"/flags/posts/"+e+"/add/"+t.ReportType,type:"POST",data:{fkey:StackExchange.options.user.fkey,otherText:i}}).done(function(e){setTimeout(function(){return D=!1},500),n(e)}).fail(function(e,t,n){r({jqXHR:e,textStatus:t,errorThrown:n})})}})}):s.FlagPromise=new Promise(function(n,r){D=!0,$.ajax({url:"//"+window.location.hostname+"/flags/posts/"+e+"/add/"+t.ReportType,type:"POST",data:{fkey:StackExchange.options.user.fkey,otherText:""}}).done(function(e){setTimeout(function(){return D=!1},500),n(e)}).fail(function(e,t,n){r({jqXHR:e,textStatus:t,errorThrown:n})})}))}return s}function v(e,t,n,r){function o(){T.removeClass("show").addClass("hide"),N=setTimeout(function(){T.empty().hide()},1e3)}var i=$("<div>").css({"background-color":t,padding:"10px"}).text(e);n&&i.css("color",n),T.append(i),T.removeClass("hide").addClass("show").show(),N&&clearTimeout(N),F&&clearTimeout(F),F=setTimeout(o,void 0===r?E:r)}function m(e){v(e,"#00690c")}function y(e){v(e,"#ba1701")}function b(e,s,a,c,u,p,l,f,h,v,b,g){return n.__awaiter(this,void 0,void 0,function(){var _,k,S,x,C,R,O,P,A,T,E,F,N,D,j;return n.__generator(this,function(n){switch(n.label){case 0:return _=function(){return $("<hr />").css({"margin-bottom":"10px","margin-top":"10px"})},k={display:"inline-block","margin-top":"5px",width:"auto"},S=$("<dl />").css({margin:"0","z-index":"1",position:"absolute","white-space":"nowrap",background:"#FFF",padding:"5px",border:"1px solid #9fa6ad","box-shadow":"0 2px 4px rgba(36,39,41,0.3)",cursor:"default"}).hide(),x="comment_checkbox_"+s,C=$("<input />").attr("type","checkbox").attr("name",x),R=$("<input />").attr("type","checkbox").attr("name",x).prop("checked",!0),O=i.IsStackOverflow(),P=e.find(".comment-body"),0===P.length&&O&&C.prop("checked",!0),[4,I(t.ConfigurationEnabledFlags)];case 1:return A=n.sent(),T=!1,E=!0,r.flagCategories.forEach(function(t){if(-1!==t.AppliesTo.indexOf(a)){var n=_();E||S.append(n);var r=t.FlagTypes.length;t.FlagTypes.forEach(function(i){i.GetComment&&(T=!0);var a=$("<dd />");t.BoxStyle&&a.css(t.BoxStyle);var _=$("<a />").css(k),x=function(){r++,_.show(),n&&r>0&&n.show()};!function(){r--,_.hide(),n&&r<=0&&n.hide()}(),(!A||A.indexOf(i.Id)>-1)&&(i.Enabled?g.then(function(e){if(i.Enabled){var t=e.length>0;i.Enabled(t)&&x()}else x()}):x());var I;i.GetComment&&(I=i.GetComment({Reputation:c,AuthorName:u}),_.attr("title",I)),_.click(function(){if(!f)try{if(!C.is(":checked")){e.find(".comment-body .comment-copy").map(function(e,t){return $(t).text()});if(I){var t=I.replace(/\[([^\]]+)\]\(([^\]]+)\)/g,"$1");t=t.replace(/\[([^\]]+)\][^\(]*?/g,"$1"),t=t.replace(/_([^_]+)_/g,"$1"),t=t.replace(/\*\*([^\*]+)\*\*/g,"$1"),t=t.replace(/\*([^\*]+)\*/g,"$1"),e.find(".comment-body .comment-copy").each(function(e,n){var r=$(n),o=r.text();o.endsWith(" - From Review")&&(o=o.substring(0,o.length-" - From Review".length)),o===t&&r.closest("li").find("a.comment-up.comment-up-off").trigger("click")})}I=void 0}var n=d(s,i,R.is(":checked"),I,g);n.CommentPromise&&n.CommentPromise.then(function(e){var t=StackExchange.comments.uiForPost($("#comments-"+s));t.addShow(!0,!1),t.showComments(e,null,!1,!0),$(document).trigger("comment",s)}).catch(function(e){y("Failed to comment on post"),console.log(e)}),n.FlagPromise&&n.FlagPromise.then(function(){var e=new Date;e.setDate(e.getDate()+30),o.SimpleCache.StoreInCache("AdvancedFlagging.Flagged."+s,i,e),h.attr("title","Flagged as "+i.ReportType),h.show(),m("Flagged")}).catch(function(e){y("Failed to flag post"),console.log(e)})}catch(e){y(e)}if("NoFlag"===i.ReportType){var r=new Date;r.setDate(r.getDate()+30),o.SimpleCache.StoreInCache("AdvancedFlagging.PerformedAction."+s,i,r),v.attr("title","Performed action: "+i.DisplayName),v.show()}w(i,b,p,l),S.hide()}),_.text(i.DisplayName),a.append(_),S.append(a)}),E=!1}}),O||(T=!1),S.append(_()),T&&(F=$("<label />").text("Leave comment").attr("for",x).css({"margin-right":"5px","margin-left":"4px"}),F.click(function(){return C.click()}),N=$("<dd />"),N.append(F),N.append(C),S.append(N)),D=$("<label />").text("Flag").attr("for",x).css({"margin-right":"5px","margin-left":"4px"}),D.click(function(){return R.click()}),j=$("<dd />"),j.append(D),j.append(R),S.append(j),[2,S]}})})}function w(e,t,n,r){for(var o="PostSpam"===e.ReportType||"PostOffensive"===e.ReportType,i="AnswerNotAnAnswer"===e.ReportType,s="PostOther"===e.ReportType,a="NoFlag"===e.ReportType,c=0;c<t.length;c++)!function(c){var u=t[c],p=null;if(o)p=u.ReportRedFlag();else if(i)p=u.ReportNaa(n,r);else if(a)switch(e.DisplayName){case"Needs Editing":p=u.ReportNeedsEditing();break;case"Vandalism":p=u.ReportVandalism();break;default:p=u.ReportLooksFine()}else if(s)switch(e.DisplayName){case"Duplicate answer":p=u.ReportDuplicateAnswer();break;case"Plagiarism":case"Bad attribution":p=u.ReportPlagiarism();break;default:throw new Error("Could not find custom flag type: "+e.DisplayName)}p&&p.then(function(e){e&&m("Feedback sent to "+u.name)}).catch(function(e){y("Failed to send feedback to "+u.name+".")})}(c)}function g(){return n.__awaiter(this,void 0,void 0,function(){var e=this;return n.__generator(this,function(r){return i.parseQuestionsAndAnswers(function(r){return n.__awaiter(e,void 0,void 0,function(){var e,i,u,f,h,d,v,y,g,R,O,P,T,E,F,N,j,M,G,q,U,L;return n.__generator(this,function(n){switch(n.label){case 0:return i=null,(u=S().click(function(){window.open("https://sentinel.erwaysoftware.com/posts/aid/"+r.postId,"_blank")}),f=function(e){return e.css("display","inline-block")},h=x(),d=new p.CopyPastorAPI(r.postId,A),v=d.Watch(),y=C(),g=[],"Answer"===r.type&&(R=new s.NattyAPI(r.postId),R.Watch().subscribe(function(e){e?f(u):u.hide()}),g.push({name:"Natty",ReportNaa:function(e,t){return R.ReportNaa(e,t)},ReportRedFlag:function(){return R.ReportRedFlag()},ReportLooksFine:function(){return R.ReportLooksFine()},ReportNeedsEditing:function(){return R.ReportNeedsEditing()},ReportVandalism:function(){return Promise.resolve(!1)},ReportDuplicateAnswer:function(){return Promise.resolve(!1)},ReportPlagiarism:function(){return Promise.resolve(!1)}}),v.subscribe(function(e){e.length?(h.attr("Title","Reported by CopyPastor - "+e.length),f(h),h.click(function(){return e.forEach(function(e){window.open("http://copypastor.sobotics.org/posts/"+e.post_id)})})):h.hide()}),g.push({name:"Guttenberg",ReportNaa:function(e,t){return d.ReportFalsePositive()},ReportRedFlag:function(){return Promise.resolve(!1)},ReportLooksFine:function(){return d.ReportFalsePositive()},ReportNeedsEditing:function(){return d.ReportFalsePositive()},ReportVandalism:function(){return d.ReportFalsePositive()},ReportDuplicateAnswer:function(){return d.ReportTruePositive()},ReportPlagiarism:function(){return d.ReportTruePositive()}}),O=new a.GenericBotAPI(r.postId),g.push({name:"Generic Bot",ReportNaa:function(e,t){return O.ReportNaa()},ReportRedFlag:function(){return Promise.resolve(!1)},ReportLooksFine:function(){return O.ReportLooksFine()},ReportNeedsEditing:function(){return O.ReportNeedsEditing()},ReportVandalism:function(){return Promise.resolve(!0)},ReportDuplicateAnswer:function(){return Promise.resolve(!1)},ReportPlagiarism:function(){return Promise.resolve(!1)}})),P=new c.MetaSmokeAPI,P.Watch(r.postId,r.type).subscribe(function(e){null!==e?(y.click(function(){window.open("https://metasmoke.erwaysoftware.com/post/"+e,"_blank")}),f(y)):y.hide()}),g.push({name:"Smokey",ReportNaa:function(e,t){return P.ReportNaa(r.postId,r.type)},ReportRedFlag:function(){return P.ReportRedFlag(r.postId,r.type)},ReportLooksFine:function(){return P.ReportLooksFine(r.postId,r.type)},ReportNeedsEditing:function(){return P.ReportNeedsEditing(r.postId,r.type)},ReportVandalism:function(){return P.ReportVandalism(r.postId,r.type)},ReportDuplicateAnswer:function(){return Promise.resolve(!1)},ReportPlagiarism:function(){return Promise.resolve(!1)}}),T=_(),E=k(),"Question"!==r.page)?[3,4]:(e=r.element.find(".post-menu"),i=$("<a />").text("Advanced Flagging"),"Answer"===r.type?(F=r.question.postTime,N=r.postTime):(F=r.postTime,N=r.postTime),j=r.element.hasClass("deleted-answer"),I(t.ConfigurationWatchFlags).then(function(e){l.WatchFlags().subscribe(function(t){if(e&&!D){var n=new RegExp("/flags/posts/"+r.postId+"/add/(AnswerNotAnAnswer|PostOffensive|PostSpam|NoFlag|PostOther)").exec(t.responseURL);if(null!==n&&200===t.status){var i={Id:0,ReportType:n[1],DisplayName:n[1]};w(i,g,N,F);var s=new Date;s.setDate(s.getDate()+30),o.SimpleCache.StoreInCache("AdvancedFlagging.Flagged."+r.postId,i,s),E.attr("title","Flagged as "+i.ReportType),E.show(),m("Flagged")}}})}),[4,I(t.ConfigurationLinkDisabled)]);case 1:return M=n.sent(),M?[3,3]:[4,b(r.element,r.postId,r.type,r.authorReputation,r.authorName,N,F,j,E,T,g,d.Promise())];case 2:G=n.sent(),i.append(G),$(window).click(function(){G.hide()}),q=i,I(t.ConfigurationOpenOnHover).then(function(e){e?(q.hover(function(e){e.stopPropagation(),e.target===q.get(0)&&G.show()}),q.mouseleave(function(e){e.stopPropagation(),G.hide()})):q.click(function(e){e.stopPropagation(),e.target===q.get(0)&&G.toggle()})}),e.append(i),n.label=3;case 3:return e.append(T),e.append(E),e.append(u),e.append(h),e.append(y),[3,5];case 4:e=r.element.find("a.answer-hyperlink"),e.after(y),e.after(h),e.after(u),e.after(E),e.after(T),n.label=5;case 5:return U=o.SimpleCache.GetFromCache("AdvancedFlagging.Flagged."+r.postId),U&&(E.attr("title","Previously flagged as "+U.ReportType),f(E)),L=o.SimpleCache.GetFromCache("AdvancedFlagging.PerformedAction."+r.postId),L&&"NoFlag"===L.ReportType&&(T.attr("title","Previously performed action: "+L.DisplayName),f(T)),[2]}})})}),[2]})})}function _(){return $("<div>").addClass("comment-flag").css({"margin-left":"5px","background-position":"-61px -320px",visibility:"visible"}).css({width:"15px",height:"15px","background-position":"-20px -320px"}).css({cursor:"default"}).hide()}function k(){return $("<div>").addClass("comment-flag").css({"margin-left":"5px","background-position":"-61px -320px",visibility:"visible"}).css({cursor:"default"}).hide()}function S(){return $("<div>").css({width:"15px",height:"16px","margin-left":"5px","vertical-align":"text-bottom",cursor:"pointer",background:'url("https://i.stack.imgur.com/aMUMt.jpg?s=128&g=1"',"background-size":"100%"}).attr("title","Reported by Natty").hide()}function x(){return $("<div>").css({width:"15px",height:"16px","margin-left":"5px","vertical-align":"text-bottom",cursor:"pointer",background:'url("https://i.stack.imgur.com/A0JRA.png?s=128&g=1"',"background-size":"100%"}).attr("title","Reported by Guttenberg").hide()}function C(){return $("<div>").css({width:"15px",height:"16px","margin-left":"5px","vertical-align":"text-bottom",cursor:"pointer",background:'url("https://i.stack.imgur.com/7cmCt.png?s=128&g=1"',"background-size":"100%"}).attr("title","Reported by Smokey").hide()}function I(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){return[2,o.SimpleCache.GetAndCache(e,function(){return u.CrossDomainCache.GetFromCache(e)})]})})}function R(e,t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return[4,o.SimpleCache.StoreInCache(e,t)];case 1:return n.sent(),[4,u.CrossDomainCache.StoreInCache(e,t)];case 2:return n.sent(),[2]}})})}function O(){return n.__awaiter(this,void 0,void 0,function(){var e,r,a,p=this;return n.__generator(this,function(d){switch(d.label){case 0:return e=function(e){if(!e)return!0;try{return!JSON.parse(e).Expires}catch(e){}return!0},r=[/^AdvancedFlagging\./,/^CopyPastor\.FindTarget\.\d+/,/^MetaSmoke.WasReported/,/^NattyApi.Feedback\.\d+/],o.SimpleCache.ClearExpiredKeys(r),o.SimpleCache.ClearAll(r,e),[4,u.CrossDomainCache.InitializeCache("https://metasmoke.erwaysoftware.com/xdom_storage.html")];case 1:return d.sent(),[4,u.CrossDomainCache.CacheFailed()];case 2:return d.sent()?[3,6]:(a=localStorage.getItem(j))?(localStorage.removeItem(j),[4,c.MetaSmokeAPI.Setup(t.metaSmokeKey,function(){return n.__awaiter(p,void 0,void 0,function(){return n.__generator(this,function(e){return[2,a]})})})]):[3,4];case 3:return d.sent(),[3,6];case 4:return[4,c.MetaSmokeAPI.Setup(t.metaSmokeKey)];case 5:d.sent(),d.label=6;case 6:return[4,f.SetupConfiguration()];case 7:return d.sent(),[4,g()];case 8:return d.sent(),h(),I(t.ConfigurationDetectAudits).then(function(e){l.WatchRequests().subscribe(function(t){if(null!==/(\/review\/next-task)|(\/review\/task-reviewed\/)/.exec(t.responseURL)&&200===t.status){var n=JSON.parse(t.responseText);e&&n.isAudit&&(v("Beware! This is an audit!","#cce5ff","#004085",5e3),$(".review-actions").hide(),setTimeout(function(){$(".review-actions").show()},5e3))}})}),document.body.appendChild(T.get(0)),I(t.ConfigurationWatchQueues).then(function(e){var t=[];l.WatchRequests().subscribe(function(n){if(e){if(null!==/(\/review\/next-task)|(\/review\/task-reviewed\/)/.exec(n.responseURL)&&200===n.status){var r=JSON.parse(n.responseText);return void function(e){var n=e.postId,r=$(e.content);t[n]={questionTime:i.parseDate($(".post-signature.owner .user-action-time span",r).attr("title")),answerTime:i.parseDate($(".post-signature .user-action-time span",r).attr("title"))}}(r)}var o=/(\d+)\/vote\/10|(\d+)\/recommend-delete/.exec(n.responseURL);if(null!==o&&200===n.status){var a=o[1]||o[2],c=parseInt(a,10),u=t[c];if(u&&$(".answers-subheader").length>0){var p=new s.NattyAPI(c);p.Watch(),w({Id:0,ReportType:"AnswerNotAnAnswer",DisplayName:"AnswerNotAnAnswer"},[{name:"Natty",ReportNaa:function(e,t){return p.ReportNaa(e,t)},ReportRedFlag:function(){return p.ReportRedFlag()},ReportLooksFine:function(){return p.ReportLooksFine()},ReportNeedsEditing:function(){return p.ReportNeedsEditing()},ReportVandalism:function(){return Promise.resolve(!1)},ReportDuplicateAnswer:function(){return Promise.resolve(!1)},ReportPlagiarism:function(){return Promise.resolve(!1)}}],u.answerTime,u.questionTime)}}}})}),[2]}})})}var P=this;Object.defineProperty(t,"__esModule",{value:!0}),t.metaSmokeKey="0a946b9419b5842f99b052d19c956302aa6c6dd5a420b043b20072ad2efc29e0";var A="wgixsmuiz8q8px9kyxgwf8l71h7a41uugfh5rkyj";t.ConfigurationOpenOnHover="AdvancedFlagging.Configuration.OpenOnHover",t.ConfigurationWatchFlags="AdvancedFlagging.Configuration.WatchFlags",t.ConfigurationWatchQueues="AdvancedFlagging.Configuration.WatchQueues",t.ConfigurationDetectAudits="AdvancedFlagging.Configuration.DetectAudits",t.ConfigurationEnabledFlags="AdvancedFlagging.Configuration.EnabledFlags",t.ConfigurationLinkDisabled="AdvancedFlagging.Configuration.LinkDisabled";var T=$("<div>").addClass("hide").hide().attr("id","snackbar"),E=2e3,F=null,N=null;t.displaySuccess=m;var D=!1,j="MetaSmoke.ManualKey";t.getFromCaches=I,t.storeInCaches=R,$(function(){return n.__awaiter(P,void 0,void 0,function(){function e(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return t?[3,2]:(t=!0,console.log("I'm starting!",new Date),[4,O()]);case 1:n.sent(),n.label=2;case 2:return $(window).off("focus",e),$(window).off("mousemove",e),[2]}})})}var t;return n.__generator(this,function(n){switch(n.label){case 0:return t=!1,$(window).focus(e),$(window).mousemove(e),document.hasFocus&&document.hasFocus()?[4,e()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})})}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t],void 0!==(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flagCategories=[{BoxStyle:{"padding-left":"5px","padding-right":"5px","background-color":"rgba(241, 148, 148, 0.6)"},AppliesTo:["Answer","Question"],FlagTypes:[{Id:1,DisplayName:"Spam",ReportType:"PostSpam"},{Id:2,DisplayName:"Rude or Abusive",ReportType:"PostOffensive"}]},{BoxStyle:{"padding-left":"5px","padding-right":"5px","background-color":"rgba(241, 148, 148, 0.6)"},AppliesTo:["Answer"],FlagTypes:[{Id:3,DisplayName:"Plagiarism",ReportType:"PostOther",Enabled:function(e){return e},GetCustomFlagText:function(e){return"Possible plagiarism of another answer https:"+e.target_url+", as can be seen here http://copypastor.sobotics.org/posts/"+e.post_id}},{Id:4,DisplayName:"Duplicate answer",ReportType:"PostOther",Enabled:function(e){return e},GetComment:function(){return"Please don't add the [same answer to multiple questions](http://meta.stackexchange.com/questions/104227/is-it-acceptable-to-add-a-duplicate-answer-to-several-questions). Answer the best one and flag the rest as duplicates, once you earn enough reputation. If it is not a duplicate, [edit] the answer and tailor the post to the question."},GetCustomFlagText:function(e){return"The answer is a repost of their other answer https:"+e.target_url+", but as there are slight differences as seen here http://copypastor.sobotics.org/posts/"+e.post_id+", an auto flag wouldn't be raised."}},{Id:18,DisplayName:"Bad attribution",ReportType:"PostOther",Enabled:function(e){return e},GetCustomFlagText:function(e){return"This post is copied from [another answer](https:"+e.target_url+"), as can be seen [here](http://copypastor.sobotics.org/posts/"+e.post_id+"). The author only added a link to the other answer, which is [not the proper way of attribution](https://stackoverflow.blog/2009/06/25/attribution-required/)."}}]},{BoxStyle:{"padding-left":"5px","padding-right":"5px"},AppliesTo:["Answer"],FlagTypes:[{Id:5,DisplayName:"Link Only",ReportType:"AnswerNotAnAnswer",GetComment:function(){return"A link to a solution is welcome, but please ensure your answer is useful without it: [add context around the link](//meta.stackexchange.com/a/8259) so your fellow users will have some idea what it is and why itâ€™s there, then quote the most relevant part of the page you're linking to in case the target page is unavailable. [Answers that are little more than a link may be deleted.](//stackoverflow.com/help/deleted-answers)"}},{Id:6,DisplayName:"Not an answer",ReportType:"AnswerNotAnAnswer",GetComment:function(e){return e.Reputation<50?"This does not provide an answer to the question. You can [search for similar questions](//stackoverflow.com/search), or refer to the related and linked questions on the right-hand side of the page to find an answer. If you have a related but different question, [ask a new question](//stackoverflow.com/questions/ask), and include a link to this one to help provide context. See: [Ask questions, get answers, no distractions](//stackoverflow.com/tour)":"This post doesn't look like an attempt to answer this question. Every post here is expected to be an explicit attempt to *answer* this question; if you have a critique or need a clarification of the question or another answer, you can [post a comment](//stackoverflow.com/help/privileges/comment) (like this one) directly below it. Please remove this answer and create either a comment or a new question. See: [Ask questions, get answers, no distractions](//stackoverflow.com/tour)"}},{Id:7,DisplayName:"Thanks",ReportType:"AnswerNotAnAnswer",GetComment:function(e){return e.Reputation<15?"Please don't add _\"thanks\"_ as answers. They don't actually provide an answer to the question, and can be perceived as noise by its future visitors. Once you [earn](http://meta.stackoverflow.com/q/146472) enough [reputation](http://stackoverflow.com/help/whats-reputation), you will gain privileges to [upvote answers](http://stackoverflow.com/help/privileges/vote-up) you like. This way future visitors of the question will see a higher vote count on that answer, and the answerer will also be rewarded with reputation points. See [Why is voting important](http://stackoverflow.com/help/why-vote).":"Please don't add _\"thanks\"_ as answers. They don't actually provide an answer to the question, and can be perceived as noise by its future visitors. Instead, [upvote answers](http://stackoverflow.com/help/privileges/vote-up) you like. This way future visitors of the question will see a higher vote count on that answer, and the answerer will also be rewarded with reputation points. See [Why is voting important](http://stackoverflow.com/help/why-vote)."}},{Id:8,DisplayName:"Me too",ReportType:"AnswerNotAnAnswer",GetComment:function(){return"Please don't add *\"Me too\"* as answers. It doesn't actually provide an answer to the question. If you have a different but related question, then [ask](//stackoverflow.com/questions/ask) it (reference this one if it will help provide context). If you're interested in this specific question, you can [upvote](//stackoverflow.com/help/privileges/vote-up) it, leave a [comment](//stackoverflow.com/help/privileges/comment), or start a [bounty](//stackoverflow.com/help/privileges/set-bounties) once you have enough [reputation](//stackoverflow.com/help/whats-reputation)."}},{Id:9,DisplayName:"Library",ReportType:"AnswerNotAnAnswer",GetComment:function(){return"Please don't just post some tool or library as an answer. At least demonstrate [how it solves the problem](http://meta.stackoverflow.com/a/251605) in the answer itself."}},{Id:10,DisplayName:"Comment",ReportType:"AnswerNotAnAnswer",GetComment:function(){return"This does not provide an answer to the question. Once you have sufficient [reputation](https://stackoverflow.com/help/whats-reputation) you will be able to [comment on any post](https://stackoverflow.com/help/privileges/comment); instead, [provide answers that don't require clarification from the asker](https://meta.stackexchange.com/questions/214173/why-do-i-need-50-reputation-to-comment-what-can-i-do-instead)."}},{Id:14,DisplayName:"Duplicate",ReportType:"AnswerNotAnAnswer",GetComment:function(){return"Instead of posting an answer which merely links to another answer, please instead [flag the question](https://stackoverflow.com/help/privileges/flag-posts) as a duplicate."}},{Id:17,DisplayName:"Non English",ReportType:"AnswerNotAnAnswer",GetComment:function(){return"Welcome to Stack Overflow. Please write your answer in English, as Stack Overflow is an [English only site](https://meta.stackoverflow.com/a/297680)."}}]},{BoxStyle:{"padding-left":"5px","padding-right":"5px"},AppliesTo:["Answer","Question"],FlagTypes:[{Id:11,DisplayName:"Looks Fine",ReportType:"NoFlag"},{Id:12,DisplayName:"Needs Editing",ReportType:"NoFlag"},{Id:13,DisplayName:"Vandalism",ReportType:"NoFlag"}]}]}.apply(t,r))&&(e.exports=o)},function(e,t,n){"use strict";function r(e){return"function"==typeof e}t.isFunction=r},function(e,t,n){"use strict";t.errorObject={e:{}}},function(e,t,n){"use strict";t.empty={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=function(e){function t(){var t=e.call(this,"object unsubscribed");this.name=t.name="ObjectUnsubscribedError",this.stack=t.stack,this.message=t.message}return r(t,e),t}(Error);t.ObjectUnsubscribedError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(4),i=function(e){function t(t,n){e.call(this),this.subject=t,this.subscriber=n,this.closed=!1}return r(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(o.Subscription);t.SubjectSubscription=i},function(e,t,n){var r,o;r=[n,t,n(0),n(3)],void 0!==(o=function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){void 0===e&&(e="https://chat.stackoverflow.com"),this.chatRoomUrl=""+e}return e.prototype.GetChannelFKey=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,o,i,s=this;return n.__generator(this,function(n){return t="StackExchange.ChatApi.FKey_"+e,o=new Promise(function(t,n){s.GetChannelPage(e).then(function(e){var r=$(e).filter("#fkey");if(r.length>0){var o=r.val();return void t(o)}n("Could not find fkey")})}),i=new Date,i.setDate(i.getDate()+1),[2,r.SimpleCache.GetAndCache(t,function(){return o},i)]})})},e.prototype.GetChatUserId=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,o,i,s=this;return n.__generator(this,function(n){return t="StackExchange.ChatApi.UserId_"+e,o=new Promise(function(t,n){s.GetChannelPage(e).then(function(e){var r=$("#active-user",$(e)),o=r.attr("class"),i=o.match(/user-(\d+)/);i&&i.length&&t(parseInt(i[1],10)),n("Could not find user id")})}),i=new Date,i.setDate(i.getDate()+1),[2,r.SimpleCache.GetAndCache(t,function(){return o},i)]})})},e.prototype.SendMessage=function(e,t,n){var r=this;return(n?Promise.resolve(n):this.GetChannelFKey(e)).then(function(n){return new Promise(function(o,i){GM_xmlhttpRequest({method:"POST",url:r.chatRoomUrl+"/chats/"+e+"/messages/new",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"text="+encodeURIComponent(t)+"&fkey="+n,onload:function(e){200!==e.status?i(e.statusText):o()},onerror:function(e){i(e)}})})})},e.prototype.GetChannelPage=function(e){var t=this,n="StackExchange.ChatApi.ChannelData_"+e,o=new Promise(function(n,r){GM_xmlhttpRequest({method:"GET",url:t.chatRoomUrl+"/rooms/"+e,onload:function(e){200!==e.status?r(e.statusText):n(e.responseText)},onerror:function(e){return r(e)}})}),i=new Date;return i.setDate(i.getDate()+1),r.SimpleCache.GetAndCache(n,function(){return o},i)},e}();t.ChatApi=o}.apply(t,r))&&(e.exports=o)},function(e,t,n){"use strict";var r=n(1),o=n(40);r.Observable.prototype.take=o.take},function(e,t,n){var r,o;r=[n,t,n(0),n(9),n(10),n(3),n(19)],void 0!==(o=function(e,t,n,r,o,i){"use strict";function s(e){return new Promise(function(t){setTimeout(function(){t()},e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.MetaSmokeDisabledConfig="MetaSmoke.Disabled",t.MetaSmokeUserKeyConfig="MetaSmoke.UserKey",t.MetaSmokeWasReportedConfig="MetaSmoke.WasReported";var a=function(){function e(){}return e.Reset=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return[4,o.CrossDomainCache.Unset(t.MetaSmokeDisabledConfig)];case 1:return e.sent(),[4,o.CrossDomainCache.Unset(t.MetaSmokeUserKeyConfig)];case 2:return e.sent(),i.SimpleCache.Unset(t.MetaSmokeDisabledConfig),i.SimpleCache.Unset(t.MetaSmokeUserKeyConfig),[2]}})})},e.IsDisabled=function(){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(n){switch(n.label){case 0:return[4,o.CrossDomainCache.GetFromCache(t.MetaSmokeDisabledConfig)];case 1:return e=n.sent(),void 0===e?[2,!1]:[2,e]}})})},e.Setup=function(r,i){return n.__awaiter(this,void 0,void 0,function(){var a=this;return n.__generator(this,function(c){return i||(i=function(r){return n.__awaiter(a,void 0,void 0,function(){var i,a;return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.IsDisabled()];case 1:return(i=n.sent())?[2]:confirm("Setting up MetaSmoke... If you do not wish to connect, press cancel. This will not show again if you press cancel. To reset configuration, see footer of Stack Overflow.")?(window.open(r,"_blank"),[4,s(100)]):(o.CrossDomainCache.StoreInCache(t.MetaSmokeDisabledConfig,!0),[2]);case 2:return n.sent(),[4,new Promise(function(e){var t=function(){$(window).off("focus",t);var n=window.prompt("Once you've authenticated FDSC with metasmoke, you'll be given a code; enter it here.");if(n)return e(n);e()};$(window).focus(t)})];case 3:return a=n.sent(),[2,a]}})})}),e.codeGetter=i,e.appKey=r,e.getUserKey(),[2]})})},e.QueryMetaSmoke=function(n,r){var o=e.GetQueryUrl(n,r),s=i.SimpleCache.GetFromCache(t.MetaSmokeWasReportedConfig+"."+o);if(void 0!==s){var a=e.GetObservableKey(n,r),c=e.ObservableLookup[a];return void(c&&c.next(s))}this.pendingTimeout&&clearTimeout(this.pendingTimeout),this.pendingPosts.push({postId:n,postType:r}),this.pendingTimeout=setTimeout(e.QueryMetaSmokeInternal,1e3)},e.QueryMetaSmokeInternal=function(){var r={},o=[];try{for(var s=n.__values(e.pendingPosts),a=s.next();!a.done;a=s.next()){var c=a.value,u=e.GetQueryUrl(c.postId,c.postType);r[u]={postId:c.postId,postType:c.postType},o.push(u)}}catch(e){f={error:e}}finally{try{a&&!a.done&&(h=s.return)&&h.call(s)}finally{if(f)throw f.error}}e.pendingPosts=[];var p=o.join(),l=new Date;l.setDate(l.getDate()+30),e.IsDisabled().then(function(o){o||$.ajax({type:"GET",url:"https://metasmoke.erwaysoftware.com/api/v2.0/posts/urls",data:{urls:p,key:""+e.appKey}}).done(function(o){try{for(var s=n.__values(o.items),a=s.next();!a.done;a=s.next()){var c=a.value,u=r[c.link];if(u){var p=e.GetObservableKey(u.postId,u.postType),f=e.ObservableLookup[p];f&&(f.next(c.id),i.SimpleCache.StoreInCache(t.MetaSmokeWasReportedConfig+"."+c.link,c.id,l)),delete r[c.link]}}}catch(e){d={error:e}}finally{try{a&&!a.done&&(v=s.return)&&v.call(s)}finally{if(d)throw d.error}}for(var h in r)if(r.hasOwnProperty(h)){var u=r[h],p=e.GetObservableKey(u.postId,u.postType),f=e.ObservableLookup[p];f&&(f.next(null),i.SimpleCache.StoreInCache(t.MetaSmokeWasReportedConfig+"."+h,null,l))}var d,v}).fail(function(t){for(var n in r)if(r.hasOwnProperty(n)){var o=r[n],i=e.GetObservableKey(o.postId,o.postType),s=e.ObservableLookup[i];s&&s.error(t)}})});var f,h},e.GetQueryUrl=function(e,t){return"Answer"===t?"//"+window.location.hostname+"/a/"+e:"//"+window.location.hostname+"/questions/"+e},e.GetSmokeyId=function(t,r){return n.__awaiter(this,void 0,void 0,function(){var o,i;return n.__generator(this,function(n){return o=this.GetObservableKey(t,r),i=e.ObservableLookup[o],i?[2,i.take(1).toPromise()]:[2,null]})})},e.GetObservableKey=function(e,t){return JSON.stringify({postId:e,postType:t})},e.getUserKey=function(){var r=this;return i.SimpleCache.GetAndCache(t.MetaSmokeUserKeyConfig,function(){return o.CrossDomainCache.GetAndCache(t.MetaSmokeUserKeyConfig,function(){return new Promise(function(t,o){return n.__awaiter(r,void 0,void 0,function(){var r,i;return n.__generator(this,function(n){switch(n.label){case 0:return r=e.actualPromise,void 0===r&&(r=e.codeGetter("https://metasmoke.erwaysoftware.com/oauth/request?key="+e.appKey),e.actualPromise=r),[4,r];case 1:return i=n.sent(),i&&$.ajax({url:"https://metasmoke.erwaysoftware.com/oauth/token?key="+e.appKey+"&code="+i,method:"GET"}).done(function(e){return t(e.token)}).fail(function(e){return o(e)}),[2]}})})})})})},e.prototype.Watch=function(t,n){var o=e.GetObservableKey(t,n);if(!e.ObservableLookup[o]){var i=new r.ReplaySubject(1);e.ObservableLookup[o]=i}return e.QueryMetaSmoke(t,n),e.ObservableLookup[o]},e.prototype.ReportNaa=function(t,r){return n.__awaiter(this,void 0,void 0,function(){var o;return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.GetSmokeyId(t,r)];case 1:return o=n.sent(),null==o?[3,3]:[4,this.SendFeedback(o,"naa-")];case 2:return n.sent(),[2,!0];case 3:return[2,!1]}})})},e.prototype.ReportRedFlag=function(r,o){return n.__awaiter(this,void 0,void 0,function(){var a,c,u,p,l,f=this;return n.__generator(this,function(h){switch(h.label){case 0:return[4,e.GetSmokeyId(r,o)];case 1:return a=h.sent(),null==a?[3,3]:[4,this.SendFeedback(a,"tpu-")];case 2:return h.sent(),[2,!0];case 3:return c="Answer"===o?"//"+window.location.hostname+"/a/"+r:"//"+window.location.hostname+"/q/"+r,u=new Promise(function(t,r){return n.__awaiter(f,void 0,void 0,function(){var o;return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.getUserKey()];case 1:return o=n.sent(),o&&$.ajax({type:"POST",url:"https://metasmoke.erwaysoftware.com/api/w/post/report",data:{post_link:c,key:e.appKey,token:o}}).done(function(){return t(!0)}).fail(function(){return r()}),[2]}})})}),[4,u];case 4:return p=h.sent(),l=e.GetQueryUrl(r,o),i.SimpleCache.Unset(t.MetaSmokeWasReportedConfig+"."+l),[4,s(1e3)];case 5:return h.sent(),e.QueryMetaSmoke(r,o),[2,p]}})})},e.prototype.ReportLooksFine=function(t,r){return n.__awaiter(this,void 0,void 0,function(){var o;return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.GetSmokeyId(t,r)];case 1:return o=n.sent(),null==o?[3,3]:[4,this.SendFeedback(o,"fp-")];case 2:return n.sent(),[2,!0];case 3:return[2,!1]}})})},e.prototype.ReportNeedsEditing=function(t,r){return n.__awaiter(this,void 0,void 0,function(){var o;return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.GetSmokeyId(t,r)];case 1:return o=n.sent(),null==o?[3,3]:[4,this.SendFeedback(o,"fp-")];case 2:return n.sent(),[2,!0];case 3:return[2,!1]}})})},e.prototype.ReportVandalism=function(t,r){return n.__awaiter(this,void 0,void 0,function(){var o;return n.__generator(this,function(n){switch(n.label){case 0:return[4,e.GetSmokeyId(t,r)];case 1:return o=n.sent(),null==o?[3,3]:[4,this.SendFeedback(o,"tp-")];case 2:return n.sent(),[2,!0];case 3:return[2,!1]}})})},e.prototype.SendFeedback=function(t,n){return new Promise(function(r,o){e.getUserKey().then(function(i){$.ajax({type:"POST",url:"https://metasmoke.erwaysoftware.com/api/w/post/"+t+"/feedback",data:{type:n,key:e.appKey,token:i}}).done(function(){return r()}).fail(function(){return o()})})})},e.ObservableLookup={},e.pendingPosts=[],e.pendingTimeout=null,e}();t.MetaSmokeAPI=a}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(0),n(7)],void 0!==(o=function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.answerId=e}return e.prototype.ReportNaa=function(){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return[4,this.makeTrackRequest()];case 1:return e=t.sent(),[2,e]}})})},e.prototype.ReportRedFlag=function(){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return[4,this.makeTrackRequest()];case 1:return e=t.sent(),[2,e]}})})},e.prototype.ReportLooksFine=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return[2,!1]})})},e.prototype.ReportNeedsEditing=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return[2,!1]})})},e.prototype.computeContentHash=function(e){if(!e)return 0;for(var t=0,n=0;n<e.length;++n)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t},e.prototype.makeTrackRequest=function(){var e=this;return new Promise(function(t,n){r.IsStackOverflow()||t(!1),0===$("#answer-"+e.answerId+" .post-text").length&&t(!1),0===$(".top-bar .my-profile .gravatar-wrapper-24").length&&n("Flag Tracker: Could not find username.");var o=$(".top-bar .my-profile .gravatar-wrapper-24").attr("title"),i=e.computeContentHash($("#answer-"+e.answerId+" .post-text").html().trim());GM_xmlhttpRequest({method:"POST",url:"https://so.floern.com/api/trackpost.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"key=Cm45BSrt51FR3ju&postId="+e.answerId+"&contentHash="+i+"&flagger="+encodeURIComponent(o),onload:function(e){200!==e.status&&n("Flag Tracker Error: Status "+e.status),t(!0)},onerror:function(e){n("Flag Tracker Error: "+e.responseText)}})})},e}();t.GenericBotAPI=o}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(0),n(5),n(9),n(7),n(3),n(18),n(19)],void 0!==(o=function(e,t,n,r,o,i,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e){this.chat=new a.ChatApi,this.subject=new r.Subject,this.replaySubject=new o.ReplaySubject,this.answerId=e}return e.prototype.Watch=function(){var e=this;if(this.subject.subscribe(this.replaySubject),i.IsStackOverflow()){var t=new Date;t.setDate(t.getDate()+1),s.SimpleCache.GetAndCache("NattyApi.Feedback."+this.answerId,function(){return new Promise(function(t,n){var r=0,o=function(e){r++,r<3?i():n("Failed to retrieve natty report: "+e)},i=function(){GM_xmlhttpRequest({method:"GET",url:"http://logs.sobotics.org/napi/api/feedback/"+e.answerId,onload:function(e){if(200===e.status){var n=JSON.parse(e.responseText);t(n.items&&n.items[0]?!0:!1)}else o(e.responseText)},onerror:function(e){o(e)}})};i()})},t).then(function(t){return e.subject.next(t)}).catch(function(t){return e.subject.error(t)})}return this.subject},e.prototype.ReportNaa=function(e,t){return n.__awaiter(this,void 0,void 0,function(){var r,o,a,c=this;return n.__generator(this,function(n){switch(n.label){case 0:if(e<t)throw new Error("Answer must be posted after the question");return i.IsStackOverflow()?[4,this.WasReported()]:[2,!1];case 1:return n.sent()?[4,this.chat.SendMessage(111347,"@Natty feedback http://stackoverflow.com/a/"+this.answerId+" tp")]:[3,3];case 2:return n.sent(),[2,!0];case 3:if(r=this.DaysBetween(e,new Date),o=this.DaysBetween(t,e),isNaN(r))throw new Error("Invalid answerDate provided");if(isNaN(o))throw new Error("Invalid questionDate provided");return r>30||o<30?[2,!1]:(a=this.chat.SendMessage(111347,"@Natty report http://stackoverflow.com/a/"+this.answerId),[4,a.then(function(){var e=new Date;e.setDate(e.getDate()+30),s.SimpleCache.StoreInCache("NattyApi.Feedback."+c.answerId,!0,e),c.subject.next(!0)})]);case 4:return n.sent(),[2,!0]}})})},e.prototype.ReportRedFlag=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return i.IsStackOverflow()?[4,this.WasReported()]:[2,!1];case 1:return e.sent()?[4,this.chat.SendMessage(111347,"@Natty feedback http://stackoverflow.com/a/"+this.answerId+" tp")]:[3,3];case 2:return e.sent(),[2,!0];case 3:return[2,!1]}})})},e.prototype.ReportLooksFine=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return i.IsStackOverflow()?[4,this.WasReported()]:[2,!1];case 1:return e.sent()?[4,this.chat.SendMessage(111347,"@Natty feedback http://stackoverflow.com/a/"+this.answerId+" fp")]:[3,3];case 2:return e.sent(),[2,!0];case 3:return[2,!1]}})})},e.prototype.ReportNeedsEditing=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return i.IsStackOverflow()?[4,this.WasReported()]:[2,!1];case 1:return e.sent()?[4,this.chat.SendMessage(111347,"@Natty feedback http://stackoverflow.com/a/"+this.answerId+" ne")]:[3,3];case 2:return e.sent(),[2,!0];case 3:return[2,!1]}})})},e.prototype.WasReported=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return[2,this.replaySubject.take(1).toPromise()]})})},e.prototype.DaysBetween=function(e,t){return(t-e)/864e5},e}();t.NattyAPI=c}.apply(t,r))&&(e.exports=o)},function(e,t,n){"use strict";function r(e,t,n){if(e){if(e instanceof o.Subscriber)return e;if(e[i.rxSubscriber])return e[i.rxSubscriber]()}return e||t||n?new o.Subscriber(e,t,n):new o.Subscriber(s.empty)}var o=n(2),i=n(8),s=n(15);t.toSubscriber=r},function(e,t,n){"use strict";t.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length}},function(e,t,n){"use strict";function r(e){return null!=e&&"object"==typeof e}t.isObject=r},function(e,t,n){"use strict";function r(){try{return i.apply(this,arguments)}catch(e){return s.errorObject.e=e,s.errorObject}}function o(e){return i=e,r}var i,s=n(14);t.tryCatch=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=function(e){function t(t){e.call(this),this.errors=t;var n=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=n.name="UnsubscriptionError",this.stack=n.stack,this.message=n.message}return r(t,e),t}(Error);t.UnsubscriptionError=o},function(e,t,n){"use strict";function r(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}var o=n(6);t.getSymbolObservable=r,t.observable=r(o.root),t.$$observable=t.observable},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return o(e)}function o(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:i.noop}var i=n(30);t.pipe=r,t.pipeFromArray=o},function(e,t,n){"use strict";function r(){}t.noop=r},function(e,t,n){"use strict";var r=n(32),o=n(35);t.queue=new o.QueueScheduler(r.QueueAction)},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(33),i=function(e){function t(t,n){e.call(this,t,n),this.scheduler=t,this.work=n}return r(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(o.AsyncAction);t.QueueAction=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(6),i=n(34),s=function(e){function t(t,n){e.call(this,t,n),this.scheduler=t,this.work=n,this.pending=!1}return r(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,this.pending=!0;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),o.root.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){return void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending?t:o.root.clearInterval(t)&&void 0||void 0},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(i.Action);t.AsyncAction=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(4),i=function(e){function t(t,n){e.call(this)}return r(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(o.Subscription);t.Action=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(36),i=function(e){function t(){e.apply(this,arguments)}return r(t,e),t}(o.AsyncScheduler);t.QueueScheduler=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(37),i=function(e){function t(){e.apply(this,arguments),this.actions=[],this.active=!1,this.scheduled=void 0}return r(t,e),t.prototype.flush=function(e){var t=this.actions;if(this.active)return void t.push(e);var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}},t}(o.Scheduler);t.AsyncScheduler=i},function(e,t,n){"use strict";var r=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=Date.now?Date.now:function(){return+new Date},e}();t.Scheduler=r},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=0),function(n){return n.lift(new a(e,t))}}var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(2),s=n(39);t.observeOn=r;var a=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.scheduler,this.delay))},e}();t.ObserveOnOperator=a;var c=function(e){function t(t,n,r){void 0===r&&(r=0),e.call(this,t),this.scheduler=n,this.delay=r}return o(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.add(this.scheduler.schedule(t.dispatch,this.delay,new u(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(s.Notification.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(s.Notification.createError(e))},t.prototype._complete=function(){this.scheduleMessage(s.Notification.createComplete())},t}(i.Subscriber);t.ObserveOnSubscriber=c;var u=function(){function e(e,t){this.notification=e,this.destination=t}return e}();t.ObserveOnMessage=u},function(e,t,n){"use strict";var r=n(1),o=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return r.Observable.of(this.value);case"E":return r.Observable.throw(this.error);case"C":return r.Observable.empty()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();t.Notification=o},function(e,t,n){"use strict";function r(e){return o.take(e)(this)}var o=n(41);t.take=r},function(e,t,n){"use strict";function r(e){return function(t){return 0===e?new a.EmptyObservable:t.lift(new c(e))}}var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(2),s=n(42),a=n(43);t.take=r;var c=function(){function e(e){if(this.total=e,this.total<0)throw new s.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.total))},e}(),u=function(e){function t(t,n){e.call(this,t),this.total=n,this.count=0}return o(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(i.Subscriber)},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=function(e){function t(){var t=e.call(this,"argument out of range");this.name=t.name="ArgumentOutOfRangeError",this.stack=t.stack,this.message=t.message}return r(t,e),t}(Error);t.ArgumentOutOfRangeError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(1),i=function(e){function t(t){e.call(this),this.scheduler=t}return r(t,e),t.create=function(e){return new t(e)},t.dispatch=function(e){e.subscriber.complete()},t.prototype._subscribe=function(e){var n=this.scheduler;if(n)return n.schedule(t.dispatch,0,{subscriber:e});e.complete()},t}(o.Observable);t.EmptyObservable=i},function(e,t,n){var r,o;r=[n,t,n(0)],void 0!==(o=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.init=function(t){if(!t.iframeUrl)throw Error("You must specify iframeUrl");var n={iframeId:t.iframeId,iframeUrl:t.iframeUrl,initCallback:t.initCallback};e.wasInitFlag||(e.wasInitFlag=!0,e.isDomReady()?e.internalInit(n):document.addEventListener?document.addEventListener("readystatechange",function(){e.isDomReady()&&e.internalInit(n)}):document.attachEvent("readystatechange",function(){e.isDomReady()&&e.internalInit(n)}))},e.setItem=function(t,n,r){e.isApiReady()&&e.buildMessage("set",t,n,r)},e.getItem=function(t,n){e.isApiReady()&&e.buildMessage("get",t,null,n)},e.removeItem=function(t,n){e.isApiReady()&&e.buildMessage("remove",t,null,n)},e.key=function(t,n){e.isApiReady()&&e.buildMessage("key",t,null,n)},e.getSize=function(t){e.isApiReady()&&e.buildMessage("size",null,null,t)},e.getLength=function(t){e.isApiReady()&&e.buildMessage("length",null,null,t)},e.clear=function(t){e.isApiReady()&&e.buildMessage("clear",null,null,t)},e.wasInit=function(){return e.wasInitFlag},e.applyCallback=function(t){e.requests[t.id]&&(e.requests[t.id](t),delete e.requests[t.id])},e.receiveMessage=function(t){var n;try{n=JSON.parse(t.data)}catch(e){}n&&n.namespace===e.MESSAGE_NAMESPACE&&("iframe-ready"===n.id?(e.iframeReady=!0,e.options.initCallback()):e.applyCallback(n))},e.buildMessage=function(t,n,r,o){e.requestId++,e.requests[e.requestId]=o;var i={namespace:e.MESSAGE_NAMESPACE,id:e.requestId,action:t,key:n,value:r};e.iframe.contentWindow.postMessage(JSON.stringify(i),"*")},e.internalInit=function(t){e.options=n.__assign({},e.defaultOptions,t);var r=document.createElement("div");window.addEventListener?window.addEventListener("message",e.receiveMessage,!1):window.attachEvent("onmessage",e.receiveMessage),r.innerHTML='<iframe id="'+e.options.iframeId+'" src='+e.options.iframeUrl+' style="display: none;"></iframe>',document.body.appendChild(r);var o=document.getElementById(e.options.iframeId);o&&(e.iframe=o)},e.isApiReady=function(){return!!e.wasInitFlag&&!!e.iframeReady},e.isDomReady=function(){return"complete"===document.readyState},e.MESSAGE_NAMESPACE="cross-domain-local-message",e.defaultOptions={iframeId:"cross-domain-iframe",initCallback:function(){}},e.requestId=1,e.requests={},e.wasInitFlag=!1,e.iframeReady=!0,e}();t.XdLocalStorage=r}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(0),n(3),n(9),n(5),n(18),n(46)],void 0!==(o=function(e,t,n,r,o,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this.answerId=e,this.key=t}return e.prototype.Watch=function(){var e=this;this.subject=new i.Subject,this.replaySubject=new o.ReplaySubject(1),this.subject.subscribe(this.replaySubject);var t=new Date;return t.setDate(t.getDate()+30),r.SimpleCache.GetAndCache("CopyPastor.FindTarget."+this.answerId,function(){return new Promise(function(t,n){var r="http://copypastor.sobotics.org/posts/findTarget?url=//"+window.location.hostname+"/a/"+e.answerId;GM_xmlhttpRequest({method:"GET",url:r,onload:function(e){var r=JSON.parse(e.responseText);"success"===r.status?t(r.posts):n(r.message)},onerror:function(e){n(e)}})})},t).then(function(t){return e.subject.next(t)}).catch(function(t){return e.subject.error(t)}),this.subject},e.prototype.Promise=function(){return this.replaySubject.take(1).toPromise()},e.prototype.ReportTruePositive=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return[2,this.SendFeedback("tp")]})})},e.prototype.ReportFalsePositive=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return[2,this.SendFeedback("fp")]})})},e.prototype.SendFeedback=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,o,i,a,c,u,p,l=this;return n.__generator(this,function(n){switch(n.label){case 0:return t=$(".top-bar .my-profile .gravatar-wrapper-24").attr("title"),r=new s.ChatApi,[4,r.GetChatUserId(111347)];case 1:return o=n.sent(),[4,this.Promise()];case 2:return i=n.sent(),a=i.map(function(n){return{post_id:n.post_id,feedback_type:e,username:t,link:"https://chat.stackoverflow.com/users/"+o,key:l.key}}),c=a.map(function(e){return new Promise(function(t,n){JSON.stringify(e);GM_xmlhttpRequest({method:"POST",url:"http://copypastor.sobotics.org/feedback/create",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"post_id="+e.post_id+"&feedback_type="+e.feedback_type+"&username="+e.username+"&link="+e.link+"&key="+e.key,onload:function(e){200!==e.status?n(JSON.parse(e.responseText)):t(!0)},onerror:function(e){n(e)}})})}),[4,Promise.all(c)];case 3:if(u=n.sent(),u.length<=0)return[2,!1];for(p=0;p<u.length;p++)if(!u[p])return[2,!1];return[2,!0]}})})},e}();t.CopyPastorAPI=a}.apply(t,r))&&(e.exports=o)},function(e,t,n){"use strict";var r=n(1),o=n(47);r.Observable.prototype.map=o.map},function(e,t,n){"use strict";function r(e,t){return o.map(e,t)(this)}var o=n(48);t.map=r},function(e,t,n){"use strict";function r(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new s(e,t))}}var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(2);t.map=r;var s=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.project,this.thisArg))},e}();t.MapOperator=s;var a=function(e){function t(t,n,r){e.call(this,t),this.project=n,this.count=0,this.thisArg=r||this}return o(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(i.Subscriber)},function(e,t,n){var r,o;r=[n,t,n(5),n(50)],void 0!==(o=function(e,t,n){"use strict";function r(){return o().filter(function(e){return!!/flags\/posts\/\d+\/add\/[a-zA-Z]+/.exec(e.responseURL)})}function o(){var e=new n.Subject;return i(function(t){e.next(t)}),e}function i(e){if(a.push(e),!s){var t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var e=this;this.addEventListener("load",function(){a.forEach(function(t){return t(e)})},!1),t.apply(this,arguments)},s=!0}}Object.defineProperty(t,"__esModule",{value:!0}),t.WatchFlags=r,t.WatchRequests=o;var s=!1,a=[]}.apply(t,r))&&(e.exports=o)},function(e,t,n){"use strict";var r=n(1),o=n(51);r.Observable.prototype.filter=o.filter},function(e,t,n){"use strict";function r(e,t){return o.filter(e,t)(this)}var o=n(52);t.filter=r},function(e,t,n){"use strict";function r(e,t){return function(n){return n.lift(new s(e,t))}}var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(2);t.filter=r;var s=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.thisArg))},e}(),a=function(e){function t(t,n,r){e.call(this,t),this.predicate=n,this.thisArg=r,this.count=0}return o(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(i.Subscriber)},function(e,t,n){var r,o;r=[n,t,n(0),n(11),n(20),n(10),n(12)],void 0!==(o=function(e,t,n,r,o,i,s){"use strict";function a(){return n.__awaiter(this,void 0,void 0,function(){var e,t,r,o;return n.__generator(this,function(n){switch(n.label){case 0:return e=$(".site-footer--copyright").children(".-list"),t=$("<div>").css("line-height","18px").css("text-align","left").css("padding","5px"),[4,i.CrossDomainCache.CacheFailed()];case 1:return n.sent()?(r=$("<p>Cache failed to initialize. AdvancedFlagging configuration disabled</p>"),t.append(r),[3,4]):[3,2];case 2:return[4,u()];case 3:n.sent(),o=$('<a href="javascript:void(0);">AdvancedFlagging configuration</a>'),o.click(function(){return p()}),t.append(o),n.label=4;case 4:return t.insertAfter(e),[2]}})})}function c(){var e=[];return s.flagCategories.forEach(function(t){t.FlagTypes.forEach(function(t){e.push({Id:t.Id,DisplayName:t.DisplayName})})}),e}function u(){return n.__awaiter(this,void 0,void 0,function(){var e,t;return n.__generator(this,function(n){switch(n.label){case 0:return[4,r.getFromCaches(r.ConfigurationEnabledFlags)];case 1:return e=n.sent(),e||(t=c().map(function(e){return e.Id}),r.storeInCaches(r.ConfigurationEnabledFlags,t)),[2]}})})}function p(){return n.__awaiter(this,void 0,void 0,function(){var e,t,o,i,s,a,c,u,p,d,v,m;return n.__generator(this,function(n){switch(n.label){case 0:return e=$("<div>").css("position","fixed").css("padding-top","100px").css("left",0).css("top",0).css("width","100%").css("height","100%").css("overflow","auto").css("background-color","#cccccc").css("background-color","rgba(0,0,0,0.4)"),t=$("<div>").css("background-color","#fefefe").css("margin","auto").css("padding","20px").css("border","1px solid #888").css("width","80%"),o=[],t.append("<h1>AdvancedFlagging configuration</h1>"),s={SectionName:"General"},[4,l()];case 1:return a=[(s.Items=n.sent(),s)],c={SectionName:"Flags"},[4,f()];case 2:return a=a.concat([(c.Items=n.sent(),c)]),u={SectionName:"Admin"},[4,h()];case 3:return i=a.concat([(u.Items=n.sent(),u)]),p=!0,i.forEach(function(e){p||t.append("<hr />"),t.append("<h2>"+e.SectionName+"</h2>"),p=!1;var n=$("<ul>").css("list-style","none");t.append(n),e.Items.forEach(function(e){if(o.push(e),e.element){var t=$("<li>").css("line-height","18px");t.append(e.element),n.append(t)}})}),d=$("<div>").css("text-align","right"),v=$('<input type="button" value="Save changes">'),m=$('<a href="#">Cancel</a>').css("margin-right","15px"),v.click(function(t){t.preventDefault();var n=!1;o.forEach(function(e){e.onSave&&e.onSave(),n=!!e.requiresReload}),e.remove(),r.displaySuccess("Configuration saved"),n&&setTimeout(function(){window.location.reload()},500)}),m.click(function(t){t.preventDefault(),e.remove()}),d.append(m),d.append(v),t.append(d),e.append(t),$(document.body).append(e),[2]}})})}function l(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return[2,Promise.all([d("Open dropdown on hover",r.ConfigurationOpenOnHover),d("Watch for manual flags",r.ConfigurationWatchFlags),d("Watch for queue responses",r.ConfigurationWatchQueues),d("Disable AdvancedFlagging link",r.ConfigurationLinkDisabled)])]})})}function f(){return n.__awaiter(this,void 0,void 0,function(){var e,t,o,i=this;return n.__generator(this,function(s){switch(s.label){case 0:return e=[],[4,r.getFromCaches(r.ConfigurationEnabledFlags)];case 1:return t=s.sent()||[],c().forEach(function(n){var r=$('<input type="checkbox">'),o=$("<label />").append(r).append(n.DisplayName);t.indexOf(n.Id)>-1&&r.prop("checked",!0),e.push({label:o,checkBox:r,Id:n.Id})}),o=e.map(function(e){return{element:e.label}}),o.push({onSave:function(){return n.__awaiter(i,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return t=e.filter(function(e){return!!e.checkBox.prop("checked")}).map(function(e){return e.Id}),[4,r.storeInCaches(r.ConfigurationEnabledFlags,t)];case 1:return n.sent(),[2]}})})},requiresReload:!0}),[2,o]}})})}function h(){return n.__awaiter(this,void 0,void 0,function(){var e=this;return n.__generator(this,function(t){return[2,[{element:$("<a />").text("Clear Metasmoke Configuration").click(function(){return n.__awaiter(e,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return[4,o.MetaSmokeAPI.Reset()];case 1:return e.sent(),[2]}})})}),requiresReload:!0},{element:$("<a />").text("Get MetaSmoke key").attr("href","https://metasmoke.erwaysoftware.com/oauth/request?key="+r.metaSmokeKey)},{element:$("<a />").text("Manually register MetaSmoke key").click(function(){return n.__awaiter(e,void 0,void 0,function(){var e;return n.__generator(this,function(t){return e=window.prompt("Enter metasmoke key"),e&&(i.CrossDomainCache.StoreInCache(o.MetaSmokeDisabledConfig,!1),localStorage.setItem("MetaSmoke.ManualKey",e)),[2]})})}),requiresReload:!0}]]})})}function d(e,t){return n.__awaiter(this,void 0,void 0,function(){var o,i,s,a=this;return n.__generator(this,function(c){switch(c.label){case 0:return o=$('<input type="checkbox">'),i=$("<label />").append(o).append(e),[4,r.getFromCaches(t)];case 1:return s=c.sent(),s&&o.prop("checked",!0),[2,{element:i,onSave:function(){return n.__awaiter(a,void 0,void 0,function(){var e;return n.__generator(this,function(n){switch(n.label){case 0:return e=!!o.prop("checked"),[4,r.storeInCaches(t,e)];case 1:return n.sent(),[2]}})})}}]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.SetupConfiguration=a}.apply(t,r))&&(e.exports=o)}]);