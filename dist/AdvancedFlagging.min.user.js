// ==UserScript==
// @name         Advanced Flagging
// @namespace    https://github.com/SOBotics
// @version      1.3.7
// @author       Robert Rudman
// @contributor  double-beep
// @match        *://*.stackexchange.com/*
// @match        *://*.stackoverflow.com/*
// @match        *://*.superuser.com/*
// @match        *://*.serverfault.com/*
// @match        *://*.askubuntu.com/*
// @match        *://*.stackapps.com/*
// @match        *://*.mathoverflow.net/*
// @exclude      *://chat.stackexchange.com/*
// @exclude      *://chat.meta.stackexchange.com/*
// @exclude      *://chat.stackoverflow.com/*
// @exclude      *://*.area51.stackexchange.com/*
// @exclude      *://data.stackexchange.com/*
// @exclude      *://stackoverflow.com/c/*
// @exclude      *://winterbash*.stackexchange.com/*
// @exclude      *://api.stackexchange.com/*
// @grant        GM_xmlhttpRequest
// @grant        GM_listValues
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_deleteValue
// @grant        GM_addStyle
// @run-at       document-body
// ==/UserScript==

(()=>{var e={422:(e,t,a)=>{var o,n;o=[a,t,a(205),a(436),a(26),a(779),a(451),a(232),a(417),a(769),a(216)],void 0===(n=function(e,t,a,o,n,s,r,i,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.displayToaster=void 0;const p=StackExchange.options.user.fkey;async function u(e,t,a,o,n,s,r){if(r)try{const t=await fetch(`/posts/${e}/comments`,{method:"POST",body:d.getFormDataFromObject({fkey:p,comment:r})});!function(e,t){const a=StackExchange.comments.uiForPost($(`#comments-${e}`));a.addShow(!0,!1),a.showComments(t,null,!1,!0),$(document).trigger("comment",e)}(e,await t.text())}catch(e){d.displayError("Failed to comment on post"),console.error(e)}if(a&&"NoFlag"!==t.ReportType){const a=o.getCopyPastorId(),r=o.getTargetUrl(),i=t.GetCustomFlagText&&a&&r?t.GetCustomFlagText(r,a):null;A=!0;const l="PostLowQuality"===t.ReportType?s?"PostLowQuality":"AnswerNotAnAnswer":t.ReportType;try{const a=await fetch(`//${window.location.hostname}/flags/posts/${e}/add/${l}`,{method:"POST",body:d.getFormDataFromObject({fkey:p,otherText:"PostOther"===t.ReportType?i:""})}),o=await a.json();if(o.Success)y(n,t.Human);else{const e=`Failed to flag the post with outcome ${o.Outcome}: ${o.Message}.`;w(function(e){let t="Failed to flag: ";return/already flagged/.exec(e.Message)?t+="post already flagged":/limit reached/.exec(e.Message)?t+="post flag limit reached":/You may only flag a post every \d+ seconds?/.exec(JSON.stringify(e))?t+="rate-limited":t+=e.Message,t}(o),e)}}catch(e){w("Failed to flag post",e)}}}const m=d.popupWrapper;let g=null,h=null;function f(){m.removeClass("show").addClass("hide"),h=window.setTimeout((()=>m.empty().addClass("hide")),1e3)}function y(e,t){if(!t)return;const a=`Flagged ${t}`;e.attr("title",a),d.showInlineElement(e),d.displaySuccess(a)}function w(e,t){d.displayError(e),console.error(t)}function v(e){return e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,"$1").replace(/\[([^\]]+)\][^(]*?/g,"$1").replace(/_([^_]+)_/g,"$1").replace(/\*\*([^*]+)\*\*/g,"$1").replace(/\*([^*]+)\*/g,"$1").replace(" - From Review","")}function k(e,t,a,o){const s=new n.NattyAPI(e,t||new Date,a||new Date),r=s.WasReported();return o&&r&&(d.showInlineElement(o),o.attr("href",`//sentinel.erwaysoftware.com/posts/aid/${e}`).attr("target","_blank")),s}function b(e){switch(e){case"AnswerNotAnAnswer":return"as NAA";case"PostOffensive":return"as R/A";case"PostSpam":return"as spam";case"NoFlag":return"";case"PostOther":return"for moderator attention";case"PostLowQuality":return"as VLQ";default:return""}}function C(e,t){const a="PostSpam"===e.ReportType||"PostOffensive"===e.ReportType,o="AnswerNotAnAnswer"===e.ReportType||"PostLowQuality"===e.ReportType,n="PostOther"===e.ReportType,s="NoFlag"===e.ReportType;t.forEach((t=>{let r=null;a?r=t.ReportRedFlag():o?r=t.ReportNaa():(s||n)&&(r=function(e,t){switch(e){case"Needs Editing":return t.ReportNeedsEditing();case"Vandalism":return t.ReportVandalism();case"Looks Fine":return t.ReportLooksFine();case"Duplicate answer":return t.ReportDuplicateAnswer();case"Plagiarism":case"Bad attribution":return t.ReportPlagiarism();default:throw new Error("Could not find custom flag type: "+e)}}(e.DisplayName,t)),r&&r.then((e=>{e&&d.displaySuccess(`Feedback sent to ${t.name}`)})).catch((()=>{d.displayError(`Failed to send feedback to ${t.name}.`)}))}))}t.displayToaster=function(e,t){const a=d.getMessageDiv(e,t);m.append(a),m.removeClass("hide").addClass("show"),h&&clearTimeout(h),g&&clearTimeout(g),g=window.setTimeout(f,d.popupDelay)};let A=!1;async function F(){await Promise.all([r.MetaSmokeAPI.Setup(d.metaSmokeKey),r.MetaSmokeAPI.QueryMetaSmokeInternal(),i.CopyPastorAPI.getAllCopyPastorIds(),n.NattyAPI.getAllNattyIds()]),function(){const e=Object.keys(d.comments).every((e=>d.getCommentFromCache(e)));Object.keys(d.flags).every((e=>d.getFlagFromCache(e)))||Object.entries(d.flags).forEach((e=>d.storeFlagsInCache(e))),e||Object.entries(d.comments).forEach((e=>d.storeCommentInCache(e)))}(),o.parseQuestionsAndAnswers((e=>{if(!e.element.length)return;const t="Answer"===e.type?e.questionTime:e.creationDate,o="Answer"===e.type?e.creationDate:null,n="Question"===e.page?e.element.find(".js-post-menu").children().first():e.element.find(`a.${"Question"===e.type?"question":"answer"}-hyperlink`),l=d.advancedFlaggingLink.clone();"Question"===e.page&&n.append(d.gridCellDiv.clone().append(l));const p=d.nattyIcon.clone(),m=d.guttenbergIcon.clone(),g=d.smokeyIcon.clone(),h=new i.CopyPastorAPI(e.postId),f=[];var w;"Answer"===e.type&&d.isStackOverflow&&(f.push(k(e.postId,t,o,p)),f.push((w=e.postId,new s.GenericBotAPI(w))),f.push(function(e,t){const a=e.getCopyPastorId();return a&&(d.showInlineElement(t),t.attr("href",`https://copypastor.sobotics.org/posts/${a}`).attr("target","_blank")),e}(h,m))),f.push(function(e,t,a){const o=r.MetaSmokeAPI.getSmokeyId(e);return o&&(a.attr("href",`https://metasmoke.erwaysoftware.com/post/${o}`).attr("target","_blank"),d.showInlineElement(a)),new r.MetaSmokeAPI(e,t)}(e.postId,e.type,g));const F=d.performedActionIcon(),I=d.reportedIcon();if("Question"===e.page){const t=e.element.hasClass("deleted-answer"),s=c.GreaseMonkeyCache.GetFromCache(d.ConfigurationWatchFlags);if(d.addXHRListener((t=>{if(!s||A||200!==t.status||!d.flagsUrlRegex.exec(t.responseURL))return;const a=d.getFlagsUrlRegex(e.postId).exec(t.responseURL);if(!a)return;const o={Id:0,ReportType:a[1],DisplayName:a[1],Human:b(a[1])};C(o,f),y(I,o.Human)})),n.append(F,I,p,m,g),c.GreaseMonkeyCache.GetFromCache(d.ConfigurationLinkDisabled))return;const r=d.qualifiesForVlq(e.score,o||new Date),i=function(e,t,o,n,s,r,i){const l=c.GreaseMonkeyCache.GetFromCache(d.ConfigurationEnabledFlags),p=c.GreaseMonkeyCache.GetFromCache(d.ConfigurationDefaultNoComment),m=c.GreaseMonkeyCache.GetFromCache(d.ConfigurationDefaultNoFlag),g=e.element.find(".comment-body"),h=d.dropDown.clone(),f=`comment_checkbox_${e.postId}`,y=`flag_checkbox_${e.postId}`,w=d.getOptionBox(f),k=d.getOptionBox(y);k.prop("checked",!m),w.prop("checked",!p&&!g.length&&d.isStackOverflow);const b=a.flagCategories.filter((t=>t.AppliesTo.includes(e.type)&&t.FlagTypes.some((e=>l&&l.includes(e.Id)))));for(const a of b){const c=d.getCategoryDiv(a.IsDangerous);for(const p of a.FlagTypes.filter((e=>l&&l.includes(e.Id)))){const a=d.reportLink.clone(),l=d.dropdownItem.clone(),m=r.getIsRepost(),g=r.getCopyPastorId();if(!p.Enabled(m,g))continue;let f;d.showElement(a),a.text(p.DisplayName),l.append(a),c.append(l),h.append(c),p.GetComment&&(f=p.GetComment({Reputation:e.authorReputation||0,AuthorName:e.authorName}),a.attr("title",f||"")),a.click((async()=>{if(!t){if(!w.is(":checked")&&f){const t=v(f);a=e.element,l=t,a.find(".comment-body .comment-copy").each(((e,t)=>{const a=$(t);a.text()===l&&a.closest("li").find("a.comment-up.comment-up-off").trigger("click")})),f=null}await u(e.postId,p,k.is(":checked"),r,o,i,f)}var a,l;"NoFlag"===p.ReportType&&(n.attr("title",`Performed action: ${p.DisplayName}`),d.showElement(n)),C(p,s),d.hideElement(h)}))}c.html()&&h.append(d.divider.clone())}if(d.isStackOverflow){const e=d.getOptionLabel("Leave comment",f),t=d.plainDiv.clone();t.append(w,e),h.append(t)}const A=d.getOptionLabel("Flag",y),F=d.plainDiv.clone();return F.append(k,A),h.append(F,d.popoverArrow.clone()),h}(e,t,I,F,f,h,r);l.append(i),c.GreaseMonkeyCache.GetFromCache(d.ConfigurationOpenOnHover)?l.hover((e=>{e.stopPropagation(),e.target===l.get(0)&&d.showElement(i)})).mouseleave((e=>{e.stopPropagation(),setTimeout((()=>d.hideElement(i)),100)})):(l.click((e=>{e.stopPropagation(),e.target===l.get(0)&&d.showElement(i)})),$(window).click((()=>d.hideElement(i))))}else n.after(g,m,p,I,F)})),GM_addStyle("\n#snackbar {\n    margin-left: -125px;\n}\n\n#snackbar.show {\n    opacity: 1;\n    transition: opacity 1s ease-out;\n    -ms-transition: opacity 1s ease-out;\n    -moz-transition: opacity 1s ease-out;\n    -webkit-transition: opacity 1s ease-out;\n}\n\n#snackbar.hide {\n    opacity: 0;\n    transition: opacity 1s ease-in;\n    -ms-transition: opacity 1s ease-in;\n    -moz-transition: opacity 1s ease-in;\n    -webkit-transition: opacity 1s ease-in;\n}\n\n.advanced-flagging-dialog {\n    min-width: 10rem !important;\n}\n\n#af-comments textarea {\n    width: calc(100% - 15px);\n    resize: vertical;\n}"),l.SetupConfiguration(),document.body.appendChild(m.get(0));const e=c.GreaseMonkeyCache.GetFromCache(d.ConfigurationWatchQueues),t=[];e&&d.addXHRListener((e=>{if(200!==e.status)return;if(d.isReviewItemRegex.exec(e.responseURL))return void(e=>{const a=JSON.parse(e),o=a.postId,n=$(a.content),s=d.parseDate($(".post-signature.owner .user-action-time span",n).attr("title")),r=d.parseDate($(".user-info .user-action-time span",n).attr("title"));s&&r&&(t[o]={questionTime:s,answerTime:r})})(e.responseText);const a=d.isDeleteVoteRegex.exec(e.responseURL);if(!a)return;const o=a[1]||a[2],n=parseInt(o,10);t[n]&&$(".answers-subheader").length&&C({Id:0,ReportType:"AnswerNotAnAnswer",DisplayName:"AnswerNotAnAnswer"},[k(n)])}))}$((()=>{let e=!1;function t(){e||(e=!0,F()),$(window).off("focus",t),$(window).off("mousemove",t)}$(window).focus(t),$(window).mousemove(t),document.hasFocus&&document.hasFocus()&&t()}))}.apply(t,o))||(e.exports=n)},417:(e,t,a)=>{var o,n;o=[a,t,a(451),a(205),a(769),a(216)],void 0===(n=function(e,t,a,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetupConfiguration=void 0;const r=n.GreaseMonkeyCache.GetFromCache(s.ConfigurationEnabledFlags);function i(){const e=[];return o.flagCategories.forEach((t=>{t.FlagTypes.forEach((t=>{e.push({Id:t.Id,DisplayName:t.DisplayName})}))})),e}function l(){const e=[];return[{text:"Open dropdown on hover",configValue:s.ConfigurationOpenOnHover},{text:"Watch for manual flags",configValue:s.ConfigurationWatchFlags},{text:"Watch for queue responses",configValue:s.ConfigurationWatchQueues},{text:"Disable AdvancedFlagging link",configValue:s.ConfigurationLinkDisabled},{text:"Uncheck 'Comment' by default",configValue:s.ConfigurationDefaultNoComment},{text:"Uncheck 'flag' by default",configValue:s.ConfigurationDefaultNoFlag}].forEach((t=>{const a=n.GreaseMonkeyCache.GetFromCache(t.configValue);e.push(d(t.text,a).attr("data-option-id",t.configValue))})),e}function c(){const e=[];return r?(i().forEach((t=>{const a=r.indexOf(t.Id)>-1,o=d(t.DisplayName,a,`flag-type-${t.Id}`).children().eq(0);e.push(o.addClass("w25 lg:w25 md:w100 sm:w100"))})),e):e}function d(e,t,a=e.toLowerCase().replace(/\s/g,"_")){const o=s.getConfigHtml(a,e),n=o.find("input");return t&&n.prop("checked",!0),o}function p(e,t,a,o){return $(`\n<div class="s-sidebarwidget">\n  <button class="s-sidebarwidget--action s-btn t4 r4 af-expandable-trigger"\n          data-controller="s-expandable-control" aria-controls="${e}-${t}">Edit</button>\n  <button class="s-sidebarwidget--action s-btn s-btn__primary t4 r6 af-submit-content d-none">Save</button>\n  <div class="s-sidebarwidget--content d-block p12 fs-body2">${t}</div>\n  <div class="s-expandable" id="${e}-${t}">\n    <div class="s-expandable--content">\n      <textarea class="grid--cell s-textarea ml8 mb8 fs-body2" rows="4" data-cache-key=${a}>${o||""}</textarea>\n    </div>\n  </div>\n</div>`)}t.SetupConfiguration=async function(){for(;"undefined"==typeof Svg;)await s.Delay(1e3);const e=$(".site-footer--copyright").children(".-list"),t=s.configurationDiv.clone(),o=s.commentsDiv.clone();!function(){if(!r){const e=i().map((e=>e.Id));n.GreaseMonkeyCache.StoreInCache(s.ConfigurationEnabledFlags,e)}}(),function(){const e=s.overlayModal.clone();e.find(".s-modal--close").append(Svg.ClearSm());const t=[{SectionName:"General",Items:l(),onSave:()=>{$(".af-section-general").find("input").each(((e,t)=>{n.GreaseMonkeyCache.StoreInCache($(t).parents().eq(2).data("option-id"),$(t).prop("checked"))}))}},{SectionName:"Flags",Items:c(),onSave:()=>{const e=$(".af-section-flags").find("input").get().filter((e=>$(e).prop("checked"))).map((e=>{const t=$(e).attr("id");return t?Number(/\d+/.exec(t)):0})).sort(((e,t)=>e-t));n.GreaseMonkeyCache.StoreInCache(s.ConfigurationEnabledFlags,e)}},{SectionName:"Admin",Items:[$("<a>").text("Clear Metasmoke Configuration").click((()=>{a.MetaSmokeAPI.Reset(),s.displayStacksToast("Successfully cleared MS configuration.","success")})),$("<a>").text("Clear chat fkey").click((()=>{n.GreaseMonkeyCache.Unset(s.CacheChatApiFkey),s.displayStacksToast("Successfully cleared chat fkey.","success")}))].map((e=>e.wrap(s.gridCellDiv.clone()).parent()))}];let o=!0;t.forEach((t=>{o||e.find("#af-modal-description").append("<hr>"),o=!1;const a=s.getSectionWrapper(t.SectionName);e.find("#af-modal-description").append(a),t.Items.forEach((e=>a.append(e)))})),e.find(".s-btn__primary").click((e=>{e.preventDefault(),t.forEach((e=>{e.onSave&&e.onSave()})),s.displayStacksToast("Configuration saved","success"),setTimeout((()=>window.location.reload()),500)})),$("body").append(e),$('label[for="flag-type-16"]').parent().removeClass("w25").css("width","20.8%");const r=$(".af-section-flags").children("div");for(let e=0;e<r.length;e+=5)r.slice(e,e+5).wrapAll(s.inlineCheckboxesWrapper.clone())}(),function(){const e=s.editCommentsPopup.clone();e.find(".s-modal--close").append(Svg.ClearSm());const t=s.commentsWrapper.clone(),a=s.flagsWrapper.clone(),o=n.GreaseMonkeyCache.GetFromCache(s.CommentsAddAuthorName);e.find(".s-modal--body").append(s.editContentWrapper.clone().append(t).append(a)).append(d("Add OP's name before comments",Boolean(o)).attr("class","af-author-name mt8"));const r=s.getAllFlags(),i=s.getAllComments();r.forEach((e=>{const t=p("flag",e.flagName,s.getFlagKey(e.flagName),e.content);a.append(t)})),i.forEach((e=>{const a=p("comment",e.commentName,s.getCommentKey(e.commentName),e.content);t.append(a)})),$(document).on("change",".af-author-name",(e=>{n.GreaseMonkeyCache.StoreInCache(s.CommentsAddAuthorName,$(e.target).is(":checked")),s.displayStacksToast("Preference updated","success")})).on("click",".af-expandable-trigger",(e=>{const t=$(e.target);t.text("Edit"===t.text()?"Hide":"Edit");const a=t.next();a.hasClass("d-none")?s.showElement(a):s.hideElement(a)})).on("click",".af-submit-content",(e=>{const t=$(e.target),a=t.next().next().find("textarea"),o=a.val(),r=a.attr("data-cache-key");if(!r)return;const i=t.next().text();n.GreaseMonkeyCache.StoreInCache(r,o),s.displayStacksToast(i+": content saved successfully","success"),t.prev().click()})),$("body").append(e)}();const u=s.configurationLink.clone(),m=s.commentsLink.clone();$(document).on("click","#af-modal-button",(()=>Stacks.showModal(document.querySelector("#af-config")))),$(document).on("click","#af-comments-button",(()=>Stacks.showModal(document.querySelector("#af-comments")))),t.append(u),o.append(m),t.insertAfter(e),o.insertAfter(e)}}.apply(t,o))||(e.exports=n)},205:(e,t,a)=>{var o,n;o=[a,t,a(216)],void 0===(n=function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flagCategories=void 0;const o=(e,t)=>e>t?"High":"Low";t.flagCategories=[{IsDangerous:!0,AppliesTo:["Answer","Question"],FlagTypes:[{Id:1,DisplayName:"Spam",ReportType:"PostSpam",Human:"as spam",Enabled:()=>!0},{Id:2,DisplayName:"Rude or Abusive",ReportType:"PostOffensive",Human:"as R/A",Enabled:()=>!0}]},{IsDangerous:!0,AppliesTo:["Answer"],FlagTypes:[{Id:3,DisplayName:"Plagiarism",ReportType:"PostOther",Human:"for moderator attention",Enabled:(e,t)=>!e&&Boolean(t),GetCustomFlagText:(e,t)=>a.getFullFlag("Plagiarism",e,t)},{Id:4,DisplayName:"Duplicate answer",ReportType:"PostOther",Human:"for moderator attention",Enabled:(e,t)=>e&&Boolean(t),GetCustomFlagText:(e,t)=>a.getFullFlag("DuplicateAnswer",e,t)},{Id:5,DisplayName:"Bad attribution",ReportType:"PostOther",Human:"for moderator attention",Enabled:(e,t)=>!e&&Boolean(t),GetCustomFlagText:(e,t)=>a.getFullFlag("BadAttribution",e,t)}]},{IsDangerous:!1,AppliesTo:["Answer"],FlagTypes:[{Id:6,DisplayName:"Link Only",ReportType:"PostLowQuality",Human:"as NAA",Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment("LinkOnly",e.AuthorName)},{Id:7,DisplayName:"Not an answer",ReportType:"AnswerNotAnAnswer",Human:"as NAA",Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(`NAA${o(e.Reputation,50)}Rep`,e.AuthorName)},{Id:8,DisplayName:"Thanks",ReportType:"AnswerNotAnAnswer",Human:"as NAA",Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(`Thanks${o(e.Reputation,50)}Rep`,e.AuthorName)},{Id:9,DisplayName:"Me too",ReportType:"AnswerNotAnAnswer",Human:"as NAA",Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment("MeToo",e.AuthorName)},{Id:10,DisplayName:"Library",ReportType:"PostLowQuality",Human:"as NAA",Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment("Library",e.AuthorName)},{Id:11,DisplayName:"Comment",ReportType:"AnswerNotAnAnswer",Human:"as NAA",Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment(`Comment${o(e.Reputation,50)}Rep`,e.AuthorName)},{Id:12,DisplayName:"Duplicate",ReportType:"AnswerNotAnAnswer",Human:"as NAA",Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment("Duplicate",e.AuthorName)},{Id:13,DisplayName:"Non English",ReportType:"PostLowQuality",Human:"as NAA",Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment("NonEnglish",e.AuthorName)},{Id:14,DisplayName:"Should be an edit",ReportType:"AnswerNotAnAnswer",Human:"as NAA",Enabled:()=>a.isStackOverflow,GetComment:e=>a.getFullComment("ShouldBeAnEdit",e.AuthorName)}]},{IsDangerous:!1,AppliesTo:["Answer","Question"],FlagTypes:[{Id:15,DisplayName:"Looks Fine",ReportType:"NoFlag",Enabled:()=>!0},{Id:16,DisplayName:"Needs Editing",ReportType:"NoFlag",Enabled:()=>!0},{Id:17,DisplayName:"Vandalism",ReportType:"NoFlag",Enabled:()=>!0}]}]}.apply(t,o))||(e.exports=n)},216:(e,t,a)=>{var o,n;o=[a,t,a(422),a(769)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDate=t.qualifiesForVlq=t.getFullFlag=t.getFullComment=t.getAllPostIds=t.addXHRListener=t.showConfirmModal=t.Delay=t.showMSTokenPopupAndGet=t.editCommentsPopup=t.inlineCheckboxesWrapper=t.overlayModal=t.flagsWrapper=t.commentsWrapper=t.editContentWrapper=t.commentsLink=t.commentsDiv=t.configurationLink=t.configurationDiv=t.advancedFlaggingLink=t.gridCellDiv=t.plainDiv=t.dropdownItem=t.reportLink=t.popoverArrow=t.dropDown=t.popupWrapper=t.divider=t.reportedIcon=t.performedActionIcon=t.getConfigHtml=t.getOptionLabel=t.getCategoryDiv=t.getOptionBox=t.getSectionWrapper=t.getMessageDiv=t.smokeyIcon=t.guttenbergIcon=t.nattyIcon=t.getFormDataFromObject=t.getParamsFromObject=t.displayError=t.displaySuccess=t.showInlineElement=t.hideElement=t.showElement=t.getFlagsUrlRegex=t.flagsUrlRegex=t.isDeleteVoteRegex=t.isReviewItemRegex=t.popupDelay=t.displayStacksToast=t.getAllComments=t.getAllFlags=t.storeFlagsInCache=t.storeCommentInCache=t.getFlagFromCache=t.getCommentFromCache=t.getFlagKey=t.getCommentKey=t.comments=t.flags=t.CommentsAddAuthorName=t.MetaSmokeDisabledConfig=t.MetaSmokeUserKeyConfig=t.CacheChatApiFkey=t.ConfigurationLinkDisabled=t.ConfigurationEnabledFlags=t.ConfigurationWatchQueues=t.ConfigurationWatchFlags=t.ConfigurationDefaultNoComment=t.ConfigurationDefaultNoFlag=t.ConfigurationOpenOnHover=t.isFlagsPage=t.isQuestionPage=t.isNatoPage=t.isStackOverflow=t.settingUpBody=t.settingUpTitle=t.dayMillis=t.username=t.nattyAllReportsUrl=t.placeholderCopypastorLink=t.placeholderTarget=t.genericBotKey=t.copyPastorServer=t.copyPastorKey=t.metasmokeApiFilter=t.metaSmokeKey=t.soboticsRoomId=void 0,t.soboticsRoomId=111347,t.metaSmokeKey="0a946b9419b5842f99b052d19c956302aa6c6dd5a420b043b20072ad2efc29e0",t.metasmokeApiFilter="GGJFNNKKJFHFKJFLJLGIJMFIHNNJNINJ",t.copyPastorKey="wgixsmuiz8q8px9kyxgwf8l71h7a41uugfh5rkyj",t.copyPastorServer="https://copypastor.sobotics.org",t.genericBotKey="Cm45BSrt51FR3ju",t.placeholderTarget=/\$TARGET\$/g,t.placeholderCopypastorLink=/\$COPYPASTOR\$/g,t.nattyAllReportsUrl="https://logs.sobotics.org/napi/api/stored/all",t.username=$(".top-bar .my-profile .gravatar-wrapper-24").attr("title"),t.dayMillis=864e5,t.settingUpTitle="Setting up MetaSmoke",t.settingUpBody="If you do not wish to connect, press cancel and this popup won't show up again. To reset configuration, see the footer of Stack Overflow.",t.isStackOverflow=Boolean(/^https:\/\/stackoverflow.com/.exec(window.location.href)),t.isNatoPage=Boolean(/\/tools\/new-answers-old-questions/.exec(window.location.href)),t.isQuestionPage=Boolean(/\/questions\/\d+.*/.exec(window.location.href)),t.isFlagsPage=Boolean(/\/users\/flag-summary\//.exec(window.location.href)),t.ConfigurationOpenOnHover="AdvancedFlagging.Configuration.OpenOnHover",t.ConfigurationDefaultNoFlag="AdvancedFlagging.Configuration.DefaultNoFlag",t.ConfigurationDefaultNoComment="AdvancedFlagging.Configuration.DefaultNoComment",t.ConfigurationWatchFlags="AdvancedFlagging.Configuration.WatchFlags",t.ConfigurationWatchQueues="AdvancedFlagging.Configuration.WatchQueues",t.ConfigurationEnabledFlags="AdvancedFlagging.Configuration.EnabledFlags",t.ConfigurationLinkDisabled="AdvancedFlagging.Configuration.LinkDisabled",t.CacheChatApiFkey="StackExchange.ChatApi.FKey",t.MetaSmokeUserKeyConfig="MetaSmoke.UserKey",t.MetaSmokeDisabledConfig="MetaSmoke.Disabled",t.CommentsAddAuthorName="AdvancedFlagging.Comments.AddAuthorName",t.flags={Plagiarism:"Possible plagiarism of another answer $TARGET$, as can be seen here $COPYPASTOR$",DuplicateAnswer:"The answer is a repost of their other answer $TARGET$, but as there are slight differences (see $COPYPASTOR$), an auto flag would not be raised.",BadAttribution:"This post is copied from [another answer]($TARGET$), as can be seen here $COPYPASTOR$. The author only added a link to the other answer, which is [not the proper way of attribution](//stackoverflow.blog/2009/06/25/attribution-required)."},t.comments={DuplicateAnswer:"Please don't add the [same answer to multiple questions](//meta.stackexchange.com/q/104227). Answer the best one and flag the rest as duplicates, once you earn enough reputation. If it is not a duplicate, [edit] the answer and tailor the post to the question.",LinkOnly:"A link to a solution is welcome, but please ensure your answer is useful without it: [add context around the link](//meta.stackexchange.com/a/8259) so your fellow users will have some idea what it is and why it is there, then quote the most relevant part of the page you are linking to in case the target page is unavailable. [Answers that are little more than a link may be deleted.](/help/deleted-answers)",NAALowRep:"This does not provide an answer to the question. You can [search for similar questions](/search), or refer to the related and linked questions on the right-hand side of the page to find an answer. If you have a related but different question, [ask a new question](/questions/ask), and include a link to this one to help provide context. See: [Ask questions, get answers, no distractions](/tour)",NAAHighRep:"This post doesn't look like an attempt to answer this question. Every post here is expected to be an explicit attempt to *answer* this question; if you have a critique or need a clarification of the question or another answer, you can [post a comment](/help/privileges/comment) (like this one) directly below it. Please remove this answer and create either a comment or a new question. See: [Ask questions, get answers, no distractions](/tour).",ThanksLowRep:"Please don't add _thanks_ as answers. They don't actually provide an answer to the question, and can be perceived as noise by its future visitors. Once you [earn](//meta.stackoverflow.com/q/146472) enough [reputation](/help/whats-reputation), you will gain privileges to [upvote answers](/help/privileges/vote-up) you like. This way future visitors of the question will see a higher vote count on that answer, and the answerer will also be rewarded with reputation points. See [Why is voting important](/help/why-vote).",ThanksHighRep:"Please don't add _thanks_ as answers. They don't actually provide an answer to the question, and can be perceived as noise by its future visitors. Instead, [upvote answers](/help/privileges/vote-up) you like. This way future visitors of the question will see a higher vote count on that answer, and the answerer will also be rewarded with reputation points. See [Why is voting important](/help/why-vote).",MeToo:"Please don't add *Me too* as answers. It doesn't actually provide an answer to the question. If you have a different but related question, then [ask](/questions/ask) it (reference this one if it will help provide context). If you are interested in this specific question, you can [upvote](/help/privileges/vote-up) it, leave a [comment](/help/privileges/comment), or start a [bounty](/help/privileges/set-bounties) once you have enough [reputation](/help/whats-reputation).",Library:"Please don't just post some tool or library as an answer. At least demonstrate [how it solves the problem](//meta.stackoverflow.com/a/251605) in the answer itself.",CommentLowRep:"This does not provide an answer to the question. Once you have sufficient [reputation](/help/whats-reputation) you will be able to [comment on any post](/help/privileges/comment); instead, [provide answers that don't require clarification from the asker](//meta.stackexchange.com/q/214173).",CommentHighRep:"This does not provide an answer to the question. Please write a comment instead.",Duplicate:"Instead of posting an answer which merely links to another answer, please instead [flag the question](/help/privileges/flag-posts) as a duplicate.",NonEnglish:"Please write your answer in English, as Stack Overflow is an [English-only site](//meta.stackoverflow.com/a/297680).",ShouldBeAnEdit:'Please use the edit link on your question to add additional information. The "Post Answer" button should be used only for complete answers to the question.'},t.getCommentKey=e=>"AdvancedFlagging.Configuration.Comments."+e,t.getFlagKey=e=>"AdvancedFlagging.Configuration.Flags."+e,t.getCommentFromCache=e=>o.GreaseMonkeyCache.GetFromCache(t.getCommentKey(e)),t.getFlagFromCache=e=>o.GreaseMonkeyCache.GetFromCache(t.getFlagKey(e)),t.storeCommentInCache=e=>o.GreaseMonkeyCache.StoreInCache(t.getCommentKey(e[0]),e[1]),t.storeFlagsInCache=e=>o.GreaseMonkeyCache.StoreInCache(t.getFlagKey(e[0]),e[1]),t.getAllFlags=()=>Object.keys(t.flags).map((e=>({flagName:e,content:t.getFlagFromCache(e)}))),t.getAllComments=()=>Object.keys(t.comments).map((e=>({commentName:e,content:t.getCommentFromCache(e)}))),t.displayStacksToast=(e,t)=>StackExchange.helpers.showToast(e,{type:t}),t.popupDelay=4e3,t.isReviewItemRegex=/\/review\/(next-task|task-reviewed\/)/,t.isDeleteVoteRegex=/(\d+)\/vote\/10|(\d+)\/recommend-delete/,t.flagsUrlRegex=/flags\/posts\/\d+\/add\/[a-zA-Z]+/,t.getFlagsUrlRegex=e=>new RegExp(`/flags/posts/${e}/add/(AnswerNotAnAnswer|PostOffensive|PostSpam|NoFlag|PostOther|PostLowQuality)`),t.showElement=e=>e.addClass("d-block").removeClass("d-none"),t.hideElement=e=>e.addClass("d-none").removeClass("d-block"),t.showInlineElement=e=>e.addClass("d-inline-block").removeClass("d-none"),t.displaySuccess=e=>a.displayToaster(e,"success"),t.displayError=e=>a.displayToaster(e,"danger"),t.getParamsFromObject=e=>Object.entries(e).map((e=>e.join("="))).join("&"),t.getFormDataFromObject=e=>Object.keys(e).reduce(((t,a)=>(t.append(a,e[a]),t)),new FormData);const n=$("<a>").attr("class","s-avatar s-avatar__16 s-user-card--avatar d-none").addClass(/\/users\/flag-summary/.exec(window.location.href)?"mx4 my2":"m4").append($("<img>").addClass("s-avatar--image"));t.nattyIcon=n.clone().attr("title","Reported by Natty").find("img").attr("src","https://i.stack.imgur.com/aMUMt.jpg?s=32&g=1").parent(),t.guttenbergIcon=n.clone().attr("title","Reported by Guttenberg").find("img").attr("src","https://i.stack.imgur.com/tzKAI.png?s=32&g=1").parent(),t.smokeyIcon=n.clone().attr("title","Reported by Smokey").find("img").attr("src","https://i.stack.imgur.com/7cmCt.png?s=32&g=1").parent(),t.getMessageDiv=(e,t)=>$("<div>").attr("class","p12 bg-"+t).text(e),t.getSectionWrapper=e=>$("<fieldset>").attr("class",`grid gs8 gsy fd-column af-section-${e.toLowerCase()}`).html(`<h2 class="grid--cell">${e}</h2>`),t.getOptionBox=e=>$("<input>").attr("type","checkbox").attr("name",e).attr("id",e).attr("class","s-checkbox"),t.getCategoryDiv=e=>$("<div>").attr("class","advanced-flagging-category bar-md"+(e?" bg-red-200":"")),t.getOptionLabel=(e,t)=>$("<label>").text(e).attr("for",t).attr("class","s-label ml4 va-middle fs-body1 fw-normal"),t.getConfigHtml=(e,t)=>$(`\n<div>\n  <div class="grid gs4">\n    <div class="grid--cell"><input class="s-checkbox" type="checkbox" id="${e}"/></div>\n    <label class="grid--cell s-label fw-normal" for="${e}">${t}</label>\n  </div>\n</div>`),t.performedActionIcon=()=>$("<div>").attr("class","p2 d-none").append(Svg.CheckmarkSm().addClass("fc-green-500")),t.reportedIcon=()=>$("<div>").attr("class","p2 d-none").append(Svg.Flag().addClass("fc-red-500")),t.divider=$("<hr>").attr("class","my8"),t.popupWrapper=$("<div>").attr("id","snackbar").attr("class","hide fc-white p16 fs-body3 ps-fixed ta-center z-popover l50 t32 wmn2"),t.dropDown=$("<div>").attr("class","advanced-flagging-dialog s-popover s-anchors s-anchors__default p6 mt2 c-default d-none"),t.popoverArrow=$("<div>").attr("class","s-popover--arrow s-popover--arrow__tc"),t.reportLink=$("<a>").attr("class","d-inline-block my4"),t.dropdownItem=$("<div>").attr("class","advanced-flagging-dropdown-item px4"),t.plainDiv=$("<div>"),t.gridCellDiv=$("<div>").attr("class","grid--cell"),t.advancedFlaggingLink=$("<button>").attr("type","button").attr("class","s-btn s-btn__link").text("Advanced Flagging"),t.configurationDiv=$("<div>").attr("class","advanced-flagging-configuration-div ta-left pt6"),t.configurationLink=$("<a>").attr("id","af-modal-button").text("AdvancedFlagging configuration"),t.commentsDiv=t.configurationDiv.clone().removeClass("advanced-flagging-configuration-div").addClass("af-comments-div"),t.commentsLink=t.configurationLink.clone().attr("id","af-comments-button").text("AdvancedFlagging: edit comments and flags"),t.editContentWrapper=$("<div>").attr("class","grid grid__fl1 md:fd-column gs16");const s=$("<h2>").attr("class","ta-center mb8").text("Comments"),r=$("<h2>").attr("class","ta-center mb8").text("Flags");t.commentsWrapper=$("<div>").attr("class","af-comments-content grid--cell").append(s),t.flagsWrapper=$("<div>").attr("class","af-flags-content grid--cell").append(r),t.overlayModal=$('\n<aside class="s-modal" id="af-config" role="dialog" aria-hidden="true" data-controller="s-modal" data-target="s-modal.modal">\n  <div class="s-modal--dialog s-modal__full w60 sm:w100" role="document">\n    <h1 class="s-modal--header fw-body c-movey" id="af-modal-title">AdvancedFlagging configuration</h1>\n    <div class="s-modal--body fs-body2" id="af-modal-description"></div>\n    <div class="grid gs8 gsx s-modal--footer">\n      <button class="grid--cell s-btn s-btn__primary" type="button">Save changes</button>\n      <button class="grid--cell s-btn" type="button" data-action="s-modal#hide">Cancel</button>\n    </div>\n    <button class="s-modal--close s-btn s-btn__muted" href="#" aria-label="Close" data-action="s-modal#hide"></button>\n  </div>\n</aside>');const i=$("<div>").attr("class","grid lg:grid md:fd-column sm:fd-column");t.inlineCheckboxesWrapper=t.gridCellDiv.clone().addClass("grid--cell lg:grid--cell md:m0 sm:m0").append(i.clone());const l=$('\n<aside class="s-modal" id="af-ms-token" role="dialog" aria-hidden="true" data-controller="s-modal" data-target="s-modal.modal">\n  <div class="s-modal--dialog s-modal__full sm:w100 md:w100" role="document">\n    <h1 class="s-modal--header fw-bold " id="af-modal-title">Authenticate MS with AF</h1>\n    <div class="s-modal--body fs-body2" id="af-modal-description">\n      <div class="grid gs4 gsy fd-column">\n        <div class="grid--cell">\n          <label class="d-block s-label" for="example-item1">Metasmoke access token\n            <p class="s-description mt2">Once you\'ve authenticated Advanced Flagging with metasmoke, you\'ll be given a code; enter it below:</p>\n          </label>\n        </div>\n      <div class="grid ps-relative"><input class="s-input" type="text" id="advanced-flagging-ms-token" placeholder="Enter the code here"></div>\n      </div>\n    </div>\n    <div class="grid gs8 gsx s-modal--footer">\n      <button class="grid--cell s-btn s-btn__primary" id="advanced-flagging-save-ms-token" type="button">Submit</button>\n      <button class="grid--cell s-btn" type="button" data-action="s-modal#hide">Cancel</button>\n    </div>\n    <button class="s-modal--close s-btn s-btn__muted" href="#" aria-label="Close" data-action="s-modal#hide"></button>\n  </div>\n</aside>');t.editCommentsPopup=$('\n<aside class="s-modal" id="af-comments" role="dialog" aria-hidden="true" data-controller="s-modal" data-target="s-modal.modal">\n  <div class="s-modal--dialog s-modal__full lg:w75 md:w75 sm:w100 w75" role="document">\n    <h1 class="s-modal--header fw-body c-movey" id="af-comments-title">AdvancedFlagging: edit comments and flags</h1>\n    <div class="s-modal--body fs-body2" id="af-comments-description"></div>\n    <div class="grid gs8 gsx s-modal--footer">\n      <button class="grid--cell s-btn s-btn__primary" type="button" data-action="s-modal#hide">I\'m done!</button>\n      <button class="grid--cell s-btn" type="button" data-action="s-modal#hide">Cancel</button>\n    </div>\n    <button class="s-modal--close s-btn s-btn__muted" href="#" aria-label="Close" data-action="s-modal#hide"></button>\n  </div>\n</aside>'),t.showMSTokenPopupAndGet=function(){return new Promise((e=>{StackExchange.helpers.showModal(l),$("#advanced-flagging-save-ms-token").on("click",(()=>{const t=$("#advanced-flagging-ms-token").val();$("#af-ms-token").remove(),t&&e(t.toString())}))}))},t.Delay=async function(e){return await new Promise((t=>setTimeout(t,e)))},t.showConfirmModal=async function(e,t){return await StackExchange.helpers.showConfirmModal({title:e,bodyHtml:t,buttonLabel:"Authenticate!"})};let c=!1;const d=[];t.addXHRListener=function(e){if(d.push(e),c)return;const t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(...e){this.addEventListener("load",(()=>{d.forEach((e=>e(this)))}),!1),t.apply(this,e)},c=!0},t.getAllPostIds=function(e,a){return $(t.isQuestionPage?".question, .answer":".flagged-post").get().map((o=>{const n=$(o),s=(t.isQuestionPage?n.attr("data-questionid"):n.find(".question-hyperlink").length)?"Question":"Answer";if(!e&&"Question"===s)return 0;const r=n.find(`.${s.toLowerCase()}-hyperlink`).attr("href");let i;return i=Number(r?"Answer"===s?r.split("#")[1]:r.split("/")[2]:n.attr("data-questionid")||n.attr("data-answerid")),a?`//${window.location.hostname}/${"Answer"===s?"a":"questions"}/${i}`:i})).filter((e=>e))},t.getFullComment=function(e,a){const n=o.GreaseMonkeyCache.GetFromCache(t.CommentsAddAuthorName),s=t.getCommentFromCache(e);return s&&n?`${a}, ${s[0].toLowerCase()}${s.slice(1)}`:s},t.getFullFlag=function(e,a,o){const n=t.getFlagFromCache(e);if(n)return n.replace(t.placeholderTarget,a).replace(t.placeholderCopypastorLink,(e=>`https://copypastor.sobotics.org/posts/${e}`)(o))},t.qualifiesForVlq=function(e,a){return e<=0&&(new Date).valueOf()-a.valueOf()<t.dayMillis},t.parseDate=function(e){return e?new Date(e.replace(" ","T")):null}}.apply(t,o))||(e.exports=n)},563:(e,t,a)=>{var o,n;o=[a,t,a(769),a(216)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatApi=void 0;class n{constructor(e="https://chat.stackoverflow.com"){this.chatRoomUrl=e}static GetExpiryDate(){const e=new Date;return e.setDate(e.getDate()+1),e}GetChannelFKey(e){const t=n.GetExpiryDate();return a.GreaseMonkeyCache.GetAndCache(o.CacheChatApiFkey,(()=>new Promise(((t,a)=>{this.GetChannelPage(e).then((e=>{const a=$(e).filter("#fkey").val();a&&t(a.toString())})).catch((()=>a()))}))),t)}GetChatUserId(){return StackExchange.options.user.userId}SendMessage(e,t=o.soboticsRoomId){return new Promise(((n,s)=>{const r=async()=>{const a=await this.GetChannelFKey(t);GM_xmlhttpRequest({method:"POST",url:`${this.chatRoomUrl}/chats/${t}/messages/new`,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"text="+encodeURIComponent(e)+"&fkey="+a,onload:e=>{200===e.status?n():l()},onerror:()=>{l()}})};let i=0;const l=()=>{i++,i<3?(a.GreaseMonkeyCache.Unset(o.CacheChatApiFkey),r()):s()};r()}))}GetChannelPage(e){return new Promise(((t,a)=>{GM_xmlhttpRequest({method:"GET",url:`${this.chatRoomUrl}/rooms/${e}`,onload:e=>{200===e.status?t(e.responseText):a()},onerror:()=>a()})}))}}t.ChatApi=n}.apply(t,o))||(e.exports=n)},232:(e,t,a)=>{var o,n;o=[a,t,a(563),a(216)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyPastorAPI=void 0;class n{constructor(e){this.name="Guttenberg",this.answerId=e}static async getAllCopyPastorIds(){if(!o.isStackOverflow)return;const e=o.getAllPostIds(!1,!0);await this.storeReportedPosts(e)}static storeReportedPosts(e){return new Promise(((t,a)=>{const n=`${o.copyPastorServer}/posts/findTarget?url=${e.join(",")}`;GM_xmlhttpRequest({method:"GET",url:n,onload:e=>{const a=JSON.parse(e.responseText);"failure"!==a.status&&(a.posts.forEach((e=>{this.copyPastorIds.push({postId:Number(e.post_id),repost:e.repost,target_url:e.target_url})})),t())},onerror:()=>a()})}))}getCopyPastorId(){const e=n.copyPastorIds.find((e=>e.postId===this.answerId));return e?e.postId:0}getIsRepost(){const e=n.copyPastorIds.find((e=>e.postId===this.answerId));return!!e&&e.repost}getTargetUrl(){const e=n.copyPastorIds.find((e=>e.postId===this.answerId));return e?e.target_url:""}async ReportTruePositive(){return await this.SendFeedback("tp")}async ReportFalsePositive(){return await this.SendFeedback("fp")}async ReportNaa(){return await this.ReportFalsePositive()}ReportRedFlag(){return Promise.resolve(!1)}async ReportLooksFine(){return await this.ReportFalsePositive()}async ReportNeedsEditing(){return await this.ReportFalsePositive()}async ReportVandalism(){return await this.ReportFalsePositive()}async ReportDuplicateAnswer(){return await this.ReportTruePositive()}async ReportPlagiarism(){return await this.ReportTruePositive()}SendFeedback(e){const t=o.username,n=(new a.ChatApi).GetChatUserId(),s=this.getCopyPastorId();if(!s)return Promise.resolve(!1);const r={post_id:s,feedback_type:e,username:t,link:`https://chat.stackoverflow.com/users/${n}`,key:o.copyPastorKey};return new Promise(((e,t)=>{GM_xmlhttpRequest({method:"POST",url:`${o.copyPastorServer}/feedback/create`,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:Object.entries(r).map((e=>e.join("="))).join("&"),onload:a=>{200===a.status?e(!0):t(!1)},onerror:()=>{t(!1)}})}))}}t.CopyPastorAPI=n,n.copyPastorIds=[]}.apply(t,o))||(e.exports=n)},779:(e,t,a)=>{var o,n;o=[a,t,a(216)],void 0===(n=function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericBotAPI=void 0,t.GenericBotAPI=class{constructor(e){this.name="Generic Bot",this.answerId=e}async ReportNaa(){return await this.makeTrackRequest()}async ReportRedFlag(){return await this.makeTrackRequest()}ReportLooksFine(){return Promise.resolve(!1)}ReportNeedsEditing(){return Promise.resolve(!1)}ReportVandalism(){return Promise.resolve(!1)}ReportDuplicateAnswer(){return Promise.resolve(!1)}ReportPlagiarism(){return Promise.resolve(!1)}computeContentHash(e){if(!e)return 0;let t=0;for(let a=0;a<e.length;++a)t=(t<<5)-t+e.charCodeAt(a),t&=t;return t}makeTrackRequest(){return new Promise(((e,t)=>{a.isStackOverflow||e(!1);const o=encodeURIComponent(a.username||"");o||e(!1);const n=this.computeContentHash($(`#answer-${this.answerId} .js-post-body`).html().trim());GM_xmlhttpRequest({method:"POST",url:"https://so.floern.com/api/trackpost.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:`key=${a.genericBotKey}&postId=${this.answerId}&contentHash=${n}&flagger=${o}`,onload:a=>{200!==a.status&&t(!1),e(!0)},onerror:()=>{t(!1)}})}))}}}.apply(t,o))||(e.exports=n)},769:(e,t,a)=>{var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GreaseMonkeyCache=void 0;class a{static async GetAndCache(e,t,o){const n=a.GetFromCache(e);if(n)return n;const s=await t();return a.StoreInCache(e,s,o),s}static GetFromCache(e){const t=GM_getValue(e,null);if(!t)return null;const a=JSON.parse(t);return a.Expires&&new Date(a.Expires)<new Date?null:a.Data}static StoreInCache(e,t,a){const o=JSON.stringify({Expires:a,Data:t});GM_setValue(e,o)}static Unset(e){GM_deleteValue(e)}}t.GreaseMonkeyCache=a}.apply(t,[a,t]))||(e.exports=o)},451:(e,t,a)=>{var o,n;o=[a,t,a(769),a(216)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetaSmokeAPI=void 0;class n{constructor(e,t){this.name="Smokey",this.postId=e,this.postType=t}static Reset(){a.GreaseMonkeyCache.Unset(o.MetaSmokeDisabledConfig),a.GreaseMonkeyCache.Unset(o.MetaSmokeUserKeyConfig)}static IsDisabled(){return a.GreaseMonkeyCache.GetFromCache(o.MetaSmokeDisabledConfig)||!1}static async Setup(e){n.appKey=e,n.accessToken=await n.getUserKey()}static async QueryMetaSmokeInternal(){const e=o.getAllPostIds(!0,!0).join(",");if(n.IsDisabled())return;const t=o.getParamsFromObject({urls:e,key:`${n.appKey}`,per_page:1e3,filter:o.metasmokeApiFilter});try{const e=await fetch(`https://metasmoke.erwaysoftware.com/api/v2.0/posts/urls?${t}`);(await e.json()).items.forEach((e=>{const t=/\d+$/.exec(e.link);t&&n.metasmokeIds.push({sitePostId:Number(t[0]),metasmokeId:e.id})}))}catch(e){o.displayError("Failed to get Metasmoke URLs."),console.error(e)}}static GetQueryUrl(e,t){return`//${window.location.hostname}/${"Answer"===t?"a":"questions"}/${e}`}static async getUserKey(){for(;void 0===StackExchange.helpers.showConfirmModal;)await o.Delay(100);return await a.GreaseMonkeyCache.GetAndCache(o.MetaSmokeUserKeyConfig,(async()=>{const e=`https://metasmoke.erwaysoftware.com/oauth/request?key=${n.appKey}`,t=await n.codeGetter(e);if(!t)return"";const a=await fetch(`https://metasmoke.erwaysoftware.com/oauth/token?key=${n.appKey}&code=${t}`);return(await a.json()).token}))}static getSmokeyId(e){const t=n.metasmokeIds.find((t=>t.sitePostId===e));return t?t.metasmokeId:0}async ReportNaa(){const e=n.getSmokeyId(this.postId);return!!e&&(await this.SendFeedback(e,"naa-"),!0)}async ReportRedFlag(){const e=n.getSmokeyId(this.postId);if(e)return await this.SendFeedback(e,"tpu-"),!0;const t=n.GetQueryUrl(this.postId,this.postType);if(!n.accessToken)return!1;try{return await fetch("https://metasmoke.erwaysoftware.com/api/w/post/report",{method:"POST",body:o.getFormDataFromObject({post_link:t,key:n.appKey,token:n.accessToken})}),!0}catch(e){return!1}}async ReportLooksFine(){const e=n.getSmokeyId(this.postId);return!!e&&(await this.SendFeedback(e,"fp-"),!0)}async ReportNeedsEditing(){const e=n.getSmokeyId(this.postId);return!!e&&(await this.SendFeedback(e,"fp-"),!0)}async ReportVandalism(){const e=n.getSmokeyId(this.postId);return!!e&&(await this.SendFeedback(e,"tp-"),!0)}ReportDuplicateAnswer(){return Promise.resolve(!1)}ReportPlagiarism(){return Promise.resolve(!1)}async SendFeedback(e,t){n.accessToken&&await fetch(`https://metasmoke.erwaysoftware.com/api/w/post/${e}/feedback`,{method:"POST",body:o.getFormDataFromObject({type:t,key:n.appKey,token:n.accessToken})})}}t.MetaSmokeAPI=n,n.metasmokeIds=[],n.codeGetter=async e=>{if(!n.IsDisabled())return await o.showConfirmModal(o.settingUpTitle,o.settingUpBody)?(window.open(e,"_blank"),await o.Delay(100),await o.showMSTokenPopupAndGet()):void a.GreaseMonkeyCache.StoreInCache(o.MetaSmokeDisabledConfig,!0)}}.apply(t,o))||(e.exports=n)},26:(e,t,a)=>{var o,n;o=[a,t,a(563),a(216)],void 0===(n=function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NattyAPI=void 0;class n{constructor(e,t,o){this.chat=new a.ChatApi,this.name="Natty",this.answerId=e,this.questionDate=t,this.answerDate=o,this.feedbackMessage=`@Natty feedback https://stackoverflow.com/a/${this.answerId}`,this.reportMessage=`@Natty report https://stackoverflow.com/a/${this.answerId}`}static getAllNattyIds(){return new Promise(((e,t)=>{o.isStackOverflow||e(),GM_xmlhttpRequest({method:"GET",url:`${o.nattyAllReportsUrl}`,onload:a=>{200!==a.status&&t();const n=JSON.parse(a.responseText).items.map((e=>Number(e.name))),s=o.getAllPostIds(!1,!1);this.nattyIds=s.filter((e=>n.includes(e))),e()},onerror:()=>{t()}})}))}WasReported(){return n.nattyIds.includes(this.answerId)}async ReportNaa(){if(this.answerDate<this.questionDate)return!1;if(this.WasReported())return await this.chat.SendMessage(`${this.feedbackMessage} tp`),!0;{const e=this.DaysBetween(this.answerDate,new Date),t=this.DaysBetween(this.questionDate,this.answerDate);return!(isNaN(e)||isNaN(t)||e>30||t<30||(await this.chat.SendMessage(this.reportMessage),0))}}async ReportRedFlag(){return!!this.WasReported()&&(await this.chat.SendMessage(`${this.feedbackMessage} tp`),!0)}async ReportLooksFine(){return!!this.WasReported()&&(await this.chat.SendMessage(`${this.feedbackMessage} fp`),!0)}async ReportNeedsEditing(){return!!this.WasReported()&&(await this.chat.SendMessage(`${this.feedbackMessage} ne`),!0)}ReportVandalism(){return Promise.resolve(!1)}ReportDuplicateAnswer(){return Promise.resolve(!1)}ReportPlagiarism(){return Promise.resolve(!1)}DaysBetween(e,t){return(t.valueOf()-e.valueOf())/o.dayMillis}}t.NattyAPI=n,n.nattyIds=[]}.apply(t,o))||(e.exports=n)},436:(e,t,a)=>{var o,n;o=[a,t,a(216)],void 0===(n=function(e,t,a){"use strict";function o(e){return{score:Number(e.find(".js-vote-count").text()),authorReputation:r(e.find(".user-info .reputation-score").last()),authorName:i(e.find(".user-info .user-details").last()),creationDate:l(e.find(".user-info .relativetime").last())}}function n(e,t,a){const s=e.attr("data-answerid");if(!s)return;const r=Number(s),i=o(e);i.creationDate&&(e.find(".answercell").bind("destroyed",(()=>{setTimeout((()=>{n($(`#answer-${r}`),t,a)}))})),t({type:"Answer",element:e,page:"Question",postId:r,questionTime:a,creationDate:i.creationDate,score:i.score,authorReputation:i.authorReputation,authorName:i.authorName}))}function s(e){let t;const a=n=>{const s=n.attr("data-questionid");if(!s)return;const r=Number(s),i=o(n);i.creationDate&&(n.find(".postcell").bind("destroyed",(()=>{setTimeout((()=>{const e=$(`[data-questionid="${r}"]`);a(e)}))})),e(t={type:"Question",element:n,page:"Question",postId:r,creationDate:i.creationDate,score:i.score,authorReputation:i.authorReputation,authorName:i.authorName}))},s=$(".question");a(s),$(".answer").each(((a,o)=>n($(o),e,t.creationDate)))}function r(e){let t=e.text();const a=e.attr("title");return a?(-1!==t.indexOf("k")&&(t=a.substr("reputation score ".length)),t=t.replace(",",""),Number(t)):0}function i(e){return e.find("a").text()}function l(e){return a.parseDate((e.hasClass("relativetime")?e:e.find(".relativeTime")).attr("title"))}Object.defineProperty(t,"__esModule",{value:!0}),t.parseQuestionsAndAnswers=void 0,$.event.special.destroyed={remove:e=>{e.handler&&e.handler()}},t.parseQuestionsAndAnswers=function(e){a.isNatoPage?function(e){$(".answer-hyperlink").parent().parent().each(((t,a)=>{const o=$(a),n=o.find(".answer-hyperlink").attr("href");if(!n)return;const s=Number(n.split("#")[1]),c=l(o.find(".user-action-time")),d=l(o.find("td .relativetime"));if(!c||!d)return;const p=r(o.find(".reputation-score")),u=i(o.find(".user-details"));e({type:"Answer",element:o,page:"NATO",postId:s,creationDate:c,questionTime:d,authorReputation:p,authorName:u})}))}(e):a.isQuestionPage?s(e):a.isFlagsPage&&function(e){$(".flagged-post").each(((t,a)=>{const o=$(a),n=o.find(".answer-hyperlink").length?"Answer":"Question",s=o.find(`.${n.toLowerCase()}-hyperlink`).attr("href");if(!s)return;const r=Number("Answer"===n?s.split("#")[1]:s.split("/")[2]),c=i(o.find(".post-user-info")),d=l(o.find(".post-user-info .relativetime"));d&&e({type:n,element:o,page:"Flags",postId:r,creationDate:d,authorName:c,questionTime:null})}))}(e)}}.apply(t,o))||(e.exports=n)}},t={};!function a(o){if(t[o])return t[o].exports;var n=t[o]={exports:{}};return e[o](n,n.exports,a),n.exports}(422)})();